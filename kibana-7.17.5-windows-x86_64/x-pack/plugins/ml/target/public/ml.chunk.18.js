/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[18],{242:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var o=a(150);function s(e,t,a){const s=["kuery"===t.language?Object(o.f)(Object(o.d)(t.query)):Object(o.e)(t.query)],r=[];for(const t of e){if(t.meta.disabled||void 0!==a&&t.meta.controlledBy===a)continue;const{meta:{negate:e,type:o,key:n}}=t;let i=t.query;void 0===i&&"exists"===o&&(i={exists:{field:n}}),i&&(e?r.push(i):s.push(i))}return{bool:{must:s,must_not:r}}}},243:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var o=a(23),s=a(25),r=a(8),n=a(26);function i(e,t,a){return e.pipe(Object(s.pluck)("jobIds"),Object(s.distinctUntilChanged)(r.isEqual),Object(s.switchMap)((e=>t.getJobs$(e))),Object(s.map)((e=>e.map((e=>{const t=Object(n.a)(e.analysis_config.bucket_span);return{id:e.job_id,selected:!0,bucketSpanSeconds:t.asSeconds()}})))),Object(s.catchError)((e=>{var t;return a(null!==(t=e.body)&&void 0!==t?t:e),Object(o.of)(void 0)})))}},760:function(e,t,a){"use strict";a.r(t),a.d(t,"EmbeddableAnomalyChartsContainer",(function(){return w}));var o=a(15),s=a.n(o),r=a(40),n=a(41),i=a(8),c=a(23),l=a(25),d=a(99),u=a(43),b=a(97),m=a(78),j=a(242),O=a(243);var g=a(71),h=a.n(g),p=a(2),f=a(348),v=a(128),x=a(11);const y=p.i18n.translate("xpack.ml.explorer.charts.dashboardTooManyBucketsDescription",{defaultMessage:"This selection contains too many buckets to be displayed. You should shorten the time range of the view."}),S=({id:e,chartsData:t,showCharts:a,severity:o,setSeverity:i,mlLocator:c,timeBuckets:l,timefilter:d,onSelectEntity:u,showSelectedInterval:b})=>Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(r.EuiFlexGroup,{id:e,direction:"row",gutterSize:"l",responsive:!0},Object(x.jsx)(r.EuiFlexItem,{grow:!1},Object(x.jsx)(v.b,{severity:o,onChange:i}))),Object(x.jsx)(r.EuiSpacer,{size:"m"}),Array.isArray(t.seriesToPlot)&&0===t.seriesToPlot.length&&void 0===t.errorMessages&&Object(x.jsx)(r.EuiText,{textAlign:"center","data-test-subj":"mlNoMatchingAnomaliesMessage"},Object(x.jsx)("h4",null,Object(x.jsx)(n.FormattedMessage,{id:"xpack.ml.explorer.noMatchingAnomaliesFoundTitle",defaultMessage:"No matching anomalies found"}))),Object(x.jsx)("div",{className:"euiText explorer-charts"},a&&Object(x.jsx)(f.a,h()({},t,{severity:o.val,mlLocator:c,timeBuckets:l,timefilter:d,onSelectEntity:u,tooManyBucketsCalloutMsg:y,showSelectedInterval:b}))));var E=a(0),T=a(16),M=a(28),A=a(239);const w=({id:e,embeddableContext:t,embeddableInput:a,services:s,refresh:g,onInputChange:h,onOutputChange:p,onRenderComplete:f,onError:y,onLoading:w})=>{var I;const[_,R]=Object(o.useState)(0),[C,k]=Object(o.useState)(Object(v.c)(null!==(I=t.getInput().severityThreshold)&&void 0!==I?I:T.ANOMALY_THRESHOLD.WARNING)),[F,L]=Object(o.useState)(),[{uiSettings:B},{data:G,share:D,uiActions:N}]=s,{timefilter:q}=G.query.timefilter,H=Object(o.useMemo)((()=>D.url.locators.get(E.a)),[D]),J=Object(o.useMemo)((()=>new d.a({"histogram:maxBars":B.get(M.UI_SETTINGS.HISTOGRAM_MAX_BARS),"histogram:barTarget":B.get(M.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:B.get("dateFormat"),"dateFormat:scaled":B.get("dateFormat:scaled")})),[]);Object(o.useEffect)((()=>{h({severityThreshold:C.val}),p({severity:C.val,entityFields:F})}),[C,F]);const{chartsData:U,isLoading:z,error:W}=function(e,t,a,s,r,n,i){const[{uiSettings:g},{data:h},{anomalyDetectorService:p,anomalyExplorerService:f}]=s,{timefilter:v}=h.query.timefilter,[x,y]=Object(o.useState)(),[S,E]=Object(o.useState)(),[T,M]=Object(o.useState)(!1),A=Object(o.useMemo)((()=>new c.Subject),[]),w=Object(o.useMemo)((()=>new c.Subject),[]),I=Object(o.useMemo)((()=>new d.a({"histogram:maxBars":g.get(u.UI_SETTINGS.HISTOGRAM_MAX_BARS),"histogram:barTarget":g.get(u.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:g.get("dateFormat"),"dateFormat:scaled":g.get("dateFormat:scaled")})),[]);return Object(o.useEffect)((()=>{const t=Object(c.combineLatest)([Object(O.a)(e,p,E),e,A.pipe(Object(l.skipWhile)((e=>!e))),w,a.pipe(Object(l.startWith)(null))]).pipe(Object(l.tap)(M.bind(null,!0)),Object(l.debounceTime)(500),Object(l.tap)((()=>{i.onLoading()})),Object(l.switchMap)((([e,t,a,o])=>{var s,r;if(!e)return Object(c.of)(void 0);const{maxSeriesToPlot:n,timeRange:i,filters:d,query:u}=t,O=m.g;let g;f.setTimeRange(i);try{g=Object(j.a)(d,u)}catch(e){return E(e),Object(c.of)(void 0)}const h=f.getTimeBounds(),p={lanes:[m.g],times:[null===(s=h.min)||void 0===s?void 0:s.unix(),null===(r=h.max)||void 0===r?void 0:r.unix()],type:m.h.OVERALL},x=Object(b.i)(p,O),y=Object(b.j)(p,e),S=I.getInterval(),T=Object(b.k)(p,S.asSeconds(),h);return Object(c.forkJoin)({combinedJobs:f.getCombinedJobs(y),anomalyChartRecords:f.loadDataForCharts$(y,T.earliestMs,T.latestMs,x,p,g)}).pipe(Object(l.switchMap)((({combinedJobs:e,anomalyChartRecords:t})=>{const s=e.reduce(((e,t)=>({...e,[t.job_id]:t})),{});return Object(c.forkJoin)({chartsData:Object(c.from)(f.getAnomalyData(void 0,s,a,t,T.earliestMs,T.latestMs,v,o,n))})})))})),Object(l.catchError)((e=>(E(e.body),Object(c.of)(void 0))))).subscribe((e=>{void 0!==e&&(E(null),y(e.chartsData),M(!1),i.onRenderComplete())}));return()=>{t.unsubscribe()}}),[]),Object(o.useEffect)((()=>{A.next(r)}),[r]),Object(o.useEffect)((()=>{w.next(n)}),[n]),Object(o.useEffect)((()=>{S&&i.onError(S)}),[S]),{chartsData:x,isLoading:T,error:S}}(a,0,g,s,_,C.val,{onRenderComplete:f,onError:y,onLoading:w}),$=Object(o.useCallback)(Object(i.throttle)((e=>{Math.abs(_-e.width)>20&&R(e.width)}),500),[_]);if(W)return Object(x.jsx)(r.EuiCallOut,{title:Object(x.jsx)(n.FormattedMessage,{id:"xpack.ml.anomalyChartsEmbeddable.errorMessage",defaultMessage:"Unable to load the ML anomaly explorer data"}),color:"danger",iconType:"alert",style:{width:"100%"}},Object(x.jsx)("p",null,W.message));const P=(e,a,o)=>{const s=[{fieldName:e,fieldValue:a,operation:o}];L(s),N.getTrigger(A.a).exec({embeddable:t,data:s})};return Object(x.jsx)(r.EuiResizeObserver,{onResize:$},(a=>Object(x.jsx)("div",{id:`mlAnomalyExplorerEmbeddableWrapper-${e}`,style:{width:"100%",overflowY:"auto",overflowX:"hidden",padding:"8px"},"data-test-subj":`mlExplorerEmbeddable_${t.id}`,ref:a},z&&Object(x.jsx)(r.EuiText,{textAlign:"center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"}},Object(x.jsx)(r.EuiLoadingChart,{size:"xl",mono:!0,"data-test-subj":"mlAnomalyExplorerEmbeddableLoadingIndicator"})),void 0!==U&&!1===z&&Object(x.jsx)(S,{id:e,showCharts:!0,chartsData:U,severity:C,setSeverity:k,mlLocator:H,timeBuckets:J,timefilter:q,onSelectEntity:P,showSelectedInterval:!1}))))};t.default=w}}]);