/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.fleet_bundle_jsonpfunction=window.fleet_bundle_jsonpfunction||[]).push([[2],{141:function(e,t,a){"use strict";t.decode=t.parse=a(283),t.encode=t.stringify=a(284)},279:function(e,t,a){"use strict";var n=a(280),l=a(282);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=y,t.resolve=function(e,t){return y(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?y(e,!1,!0).resolveObject(t):t},t.format=function(e){l.isString(e)&&(e=y(e));return e instanceof i?e.format():i.prototype.format.call(e)},t.Url=i;var s=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,o=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),d=["%","/","?",";","#"].concat(u),g=["/","?","#"],m=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},E={javascript:!0,"javascript:":!0},h={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=a(141);function y(e,t,a){if(e&&l.isObject(e)&&e instanceof i)return e;var n=new i;return n.parse(e,t,a),n}i.prototype.parse=function(e,t,a){if(!l.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),r=-1!==i&&i<e.indexOf("#")?"?":"#",c=e.split(r);c[0]=c[0].replace(/\\/g,"/");var y=e=c.join(r);if(y=y.trim(),!a&&1===e.split("#").length){var v=o.exec(y);if(v)return this.path=y,this.href=y,this.pathname=v[1],v[2]?(this.search=v[2],this.query=t?b.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var k=s.exec(y);if(k){var x=(k=k[0]).toLowerCase();this.protocol=x,y=y.substr(k.length)}if(a||k||y.match(/^\/\/[^@\/]+@[^@\/]+/)){var M="//"===y.substr(0,2);!M||k&&E[k]||(y=y.substr(2),this.slashes=!0)}if(!E[k]&&(M||k&&!h[k])){for(var O,j,S=-1,F=0;F<g.length;F++){-1!==(I=y.indexOf(g[F]))&&(-1===S||I<S)&&(S=I)}-1!==(j=-1===S?y.lastIndexOf("@"):y.lastIndexOf("@",S))&&(O=y.slice(0,j),y=y.slice(j+1),this.auth=decodeURIComponent(O)),S=-1;for(F=0;F<d.length;F++){var I;-1!==(I=y.indexOf(d[F]))&&(-1===S||I<S)&&(S=I)}-1===S&&(S=y.length),this.host=y.slice(0,S),y=y.slice(S),this.parseHost(),this.hostname=this.hostname||"";var T="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!T)for(var P=this.hostname.split(/\./),w=(F=0,P.length);F<w;F++){var C=P[F];if(C&&!C.match(m)){for(var A="",L=0,_=C.length;L<_;L++)C.charCodeAt(L)>127?A+="x":A+=C[L];if(!A.match(m)){var D=P.slice(0,F),N=P.slice(F+1),B=C.match(p);B&&(D.push(B[1]),N.unshift(B[2])),N.length&&(y="/"+N.join(".")+y),this.hostname=D.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),T||(this.hostname=n.toASCII(this.hostname));var R=this.port?":"+this.port:"",z=this.hostname||"";this.host=z+R,this.href+=this.host,T&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!f[x])for(F=0,w=u.length;F<w;F++){var U=u[F];if(-1!==y.indexOf(U)){var q=encodeURIComponent(U);q===U&&(q=escape(U)),y=y.split(U).join(q)}}var H=y.indexOf("#");-1!==H&&(this.hash=y.substr(H),y=y.slice(0,H));var G=y.indexOf("?");if(-1!==G?(this.search=y.substr(G),this.query=y.substr(G+1),t&&(this.query=b.parse(this.query)),y=y.slice(0,G)):t&&(this.search="",this.query={}),y&&(this.pathname=y),h[x]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){R=this.pathname||"";var V=this.search||"";this.path=R+V}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",a=this.pathname||"",n=this.hash||"",i=!1,s="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&l.isObject(this.query)&&Object.keys(this.query).length&&(s=b.stringify(this.query));var r=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||h[t])&&!1!==i?(i="//"+(i||""),a&&"/"!==a.charAt(0)&&(a="/"+a)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),r&&"?"!==r.charAt(0)&&(r="?"+r),t+i+(a=a.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(r=r.replace("#","%23"))+n},i.prototype.resolve=function(e){return this.resolveObject(y(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if(l.isString(e)){var t=new i;t.parse(e,!1,!0),e=t}for(var a=new i,n=Object.keys(this),s=0;s<n.length;s++){var r=n[s];a[r]=this[r]}if(a.hash=e.hash,""===e.href)return a.href=a.format(),a;if(e.slashes&&!e.protocol){for(var o=Object.keys(e),c=0;c<o.length;c++){var u=o[c];"protocol"!==u&&(a[u]=e[u])}return h[a.protocol]&&a.hostname&&!a.pathname&&(a.path=a.pathname="/"),a.href=a.format(),a}if(e.protocol&&e.protocol!==a.protocol){if(!h[e.protocol]){for(var d=Object.keys(e),g=0;g<d.length;g++){var m=d[g];a[m]=e[m]}return a.href=a.format(),a}if(a.protocol=e.protocol,e.host||E[e.protocol])a.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),a.pathname=p.join("/")}if(a.search=e.search,a.query=e.query,a.host=e.host||"",a.auth=e.auth,a.hostname=e.hostname||e.host,a.port=e.port,a.pathname||a.search){var f=a.pathname||"",b=a.search||"";a.path=f+b}return a.slashes=a.slashes||e.slashes,a.href=a.format(),a}var y=a.pathname&&"/"===a.pathname.charAt(0),v=e.host||e.pathname&&"/"===e.pathname.charAt(0),k=v||y||a.host&&e.pathname,x=k,M=a.pathname&&a.pathname.split("/")||[],O=(p=e.pathname&&e.pathname.split("/")||[],a.protocol&&!h[a.protocol]);if(O&&(a.hostname="",a.port=null,a.host&&(""===M[0]?M[0]=a.host:M.unshift(a.host)),a.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),k=k&&(""===p[0]||""===M[0])),v)a.host=e.host||""===e.host?e.host:a.host,a.hostname=e.hostname||""===e.hostname?e.hostname:a.hostname,a.search=e.search,a.query=e.query,M=p;else if(p.length)M||(M=[]),M.pop(),M=M.concat(p),a.search=e.search,a.query=e.query;else if(!l.isNullOrUndefined(e.search)){if(O)a.hostname=a.host=M.shift(),(T=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=T.shift(),a.host=a.hostname=T.shift());return a.search=e.search,a.query=e.query,l.isNull(a.pathname)&&l.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.href=a.format(),a}if(!M.length)return a.pathname=null,a.search?a.path="/"+a.search:a.path=null,a.href=a.format(),a;for(var j=M.slice(-1)[0],S=(a.host||e.host||M.length>1)&&("."===j||".."===j)||""===j,F=0,I=M.length;I>=0;I--)"."===(j=M[I])?M.splice(I,1):".."===j?(M.splice(I,1),F++):F&&(M.splice(I,1),F--);if(!k&&!x)for(;F--;F)M.unshift("..");!k||""===M[0]||M[0]&&"/"===M[0].charAt(0)||M.unshift(""),S&&"/"!==M.join("/").substr(-1)&&M.push("");var T,P=""===M[0]||M[0]&&"/"===M[0].charAt(0);O&&(a.hostname=a.host=P?"":M.length?M.shift():"",(T=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=T.shift(),a.host=a.hostname=T.shift()));return(k=k||a.host&&M.length)&&!P&&M.unshift(""),M.length?a.pathname=M.join("/"):(a.pathname=null,a.path=null),l.isNull(a.pathname)&&l.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.auth=e.auth||a.auth,a.slashes=a.slashes||e.slashes,a.href=a.format(),a},i.prototype.parseHost=function(){var e=this.host,t=r.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},280:function(e,t,a){(function(e,n){var l;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(i){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof n&&n;s.global!==s&&s.window!==s&&s.self;var r,o=2147483647,c=36,u=/^xn--/,d=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,m={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,f=String.fromCharCode;function E(e){throw new RangeError(m[e])}function h(e,t){for(var a=e.length,n=[];a--;)n[a]=t(e[a]);return n}function b(e,t){var a=e.split("@"),n="";return a.length>1&&(n=a[0]+"@",e=a[1]),n+h((e=e.replace(g,".")).split("."),t).join(".")}function y(e){for(var t,a,n=[],l=0,i=e.length;l<i;)(t=e.charCodeAt(l++))>=55296&&t<=56319&&l<i?56320==(64512&(a=e.charCodeAt(l++)))?n.push(((1023&t)<<10)+(1023&a)+65536):(n.push(t),l--):n.push(t);return n}function v(e){return h(e,(function(e){var t="";return e>65535&&(t+=f((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=f(e)})).join("")}function k(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function x(e,t,a){var n=0;for(e=a?p(e/700):e>>1,e+=p(e/t);e>455;n+=c)e=p(e/35);return p(n+36*e/(e+38))}function M(e){var t,a,n,l,i,s,r,u,d,g,m,f=[],h=e.length,b=0,y=128,k=72;for((a=e.lastIndexOf("-"))<0&&(a=0),n=0;n<a;++n)e.charCodeAt(n)>=128&&E("not-basic"),f.push(e.charCodeAt(n));for(l=a>0?a+1:0;l<h;){for(i=b,s=1,r=c;l>=h&&E("invalid-input"),((u=(m=e.charCodeAt(l++))-48<10?m-22:m-65<26?m-65:m-97<26?m-97:c)>=c||u>p((o-b)/s))&&E("overflow"),b+=u*s,!(u<(d=r<=k?1:r>=k+26?26:r-k));r+=c)s>p(o/(g=c-d))&&E("overflow"),s*=g;k=x(b-i,t=f.length+1,0==i),p(b/t)>o-y&&E("overflow"),y+=p(b/t),b%=t,f.splice(b++,0,y)}return v(f)}function O(e){var t,a,n,l,i,s,r,u,d,g,m,h,b,v,M,O=[];for(h=(e=y(e)).length,t=128,a=0,i=72,s=0;s<h;++s)(m=e[s])<128&&O.push(f(m));for(n=l=O.length,l&&O.push("-");n<h;){for(r=o,s=0;s<h;++s)(m=e[s])>=t&&m<r&&(r=m);for(r-t>p((o-a)/(b=n+1))&&E("overflow"),a+=(r-t)*b,t=r,s=0;s<h;++s)if((m=e[s])<t&&++a>o&&E("overflow"),m==t){for(u=a,d=c;!(u<(g=d<=i?1:d>=i+26?26:d-i));d+=c)M=u-g,v=c-g,O.push(f(k(g+M%v,0))),u=p(M/v);O.push(f(k(u,0))),i=x(a,b,n==l),a=0,++n}++a,++t}return O.join("")}r={version:"1.4.1",ucs2:{decode:y,encode:v},decode:M,encode:O,toASCII:function(e){return b(e,(function(e){return d.test(e)?"xn--"+O(e):e}))},toUnicode:function(e){return b(e,(function(e){return u.test(e)?M(e.slice(4).toLowerCase()):e}))}},void 0===(l=function(){return r}.call(t,a,t,e))||(e.exports=l)}()}).call(this,a(281)(e),a(50))},281:function(e,t,a){e.exports=a(29)(404)},282:function(e,t,a){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},283:function(e,t,a){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,a,i){t=t||"&",a=a||"=";var s={};if("string"!=typeof e||0===e.length)return s;var r=/\+/g;e=e.split(t);var o=1e3;i&&"number"==typeof i.maxKeys&&(o=i.maxKeys);var c=e.length;o>0&&c>o&&(c=o);for(var u=0;u<c;++u){var d,g,m,p,f=e[u].replace(r,"%20"),E=f.indexOf(a);E>=0?(d=f.substr(0,E),g=f.substr(E+1)):(d=f,g=""),m=decodeURIComponent(d),p=decodeURIComponent(g),n(s,m)?l(s[m])?s[m].push(p):s[m]=[s[m],p]:s[m]=p}return s};var l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},284:function(e,t,a){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,a,r){return t=t||"&",a=a||"=",null===e&&(e=void 0),"object"==typeof e?i(s(e),(function(s){var r=encodeURIComponent(n(s))+a;return l(e[s])?i(e[s],(function(e){return r+encodeURIComponent(n(e))})).join(t):r+encodeURIComponent(n(e[s]))})).join(t):r?encodeURIComponent(n(r))+a+encodeURIComponent(n(e)):""};var l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function i(e,t){if(e.map)return e.map(t);for(var a=[],n=0;n<e.length;n++)a.push(t(e[n],n));return a}var s=Object.keys||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.push(a);return t}},285:function(e,t,a){const n=a(49);e.exports=(e,t,a)=>n(e,t,a)>=0},286:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(38),l=a(0),i=n.__importDefault(a(140)),s=a(287),r={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};t.default=s.isClient&&window.ResizeObserver?function(){var e=l.useState(null),t=e[0],a=e[1],n=l.useState(r),s=n[0],o=n[1],c=l.useMemo((function(){return new window.ResizeObserver((function(e){if(e[0]){var t=e[0].contentRect,a=t.x,n=t.y,l=t.width,i=t.height,s=t.top,r=t.left,c=t.bottom,u=t.right;o({x:a,y:n,width:l,height:i,top:s,left:r,bottom:c,right:u})}}))}),[]);return i.default((function(){if(t)return c.observe(t),function(){c.disconnect()}}),[t]),[a,s]}:function(){return[function(){},r]}},287:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDeepEqual=t.off=t.on=t.isClient=void 0;var n=a(38).__importDefault(a(288));t.isClient="object"==typeof window,t.on=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return e.addEventListener.apply(e,t)},t.off=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return e.removeEventListener.apply(e,t)},t.isDeepEqual=n.default},288:function(e,t,a){"use strict";e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var n,l,i;if(Array.isArray(t)){if((n=t.length)!=a.length)return!1;for(l=n;0!=l--;)if(!e(t[l],a[l]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((n=(i=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(l=n;0!=l--;)if(!Object.prototype.hasOwnProperty.call(a,i[l]))return!1;for(l=n;0!=l--;){var s=i[l];if(("_owner"!==s||!t.$$typeof)&&!e(t[s],a[s]))return!1}return!0}return t!=t&&a!=a}},291:function(e,t,a){"use strict";a.r(t),a.d(t,"ProtectedRoute",(function(){return Wt})),a.d(t,"renderApp",(function(){return Qt})),a.d(t,"teardownFleet",(function(){return Yt}));var n=a(0),l=a.n(n),i=a(70),s=a.n(i),r=a(8),o=a(80),c=a(6),u=a(68),d=a(4),g=a(69),m=a.n(g),p=a(139),f=a.n(p),E=a(21),h=a(71),b=a(82),y=a(81),v=a(83),k=a(90),x=a(97),M=a(86),O=a.n(M),j=a(5);const S=m()(c.EuiFlyout).withConfig({displayName:"FlyoutWithHigherZIndex",componentId:"sc-4bxzaq-0"})(["z-index:",";"],(e=>e.theme.eui.euiZLevel5)),F=({onClose:e,as:t,...a})=>{const{notifications:i}=Object(o.jb)(),s=Object(o.M)().write,[r,g]=Object(n.useState)({name:"",description:"",namespace:"default",is_default:void 0,monitoring_enabled:Object.values(j.dataTypes)}),[m,p]=Object(n.useState)(!1),[f,E]=Object(n.useState)(!0),h=Object(x.e)(r),b=l.a.createElement(c.EuiFlyoutHeader,{hasBorder:!0,"aria-labelledby":"CreateAgentPolicyFlyoutTitle"},l.a.createElement(c.EuiTitle,{size:"m"},l.a.createElement("h2",{id:"CreateAgentPolicyFlyoutTitle"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.flyoutTitle",defaultMessage:"Create agent policy"}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiText,{size:"s"},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.flyoutTitleDescription",defaultMessage:"Agent policies are used to manage settings across a group of agents. You can add integrations to your agent policy to specify what data your agents collect. When you edit an agent policy, you can use Fleet to deploy updates to a specified group of agents."})))),y=l.a.createElement(c.EuiFlyoutBody,null,l.a.createElement(x.b,{agentPolicy:r,updateAgentPolicy:e=>{g({...r,...e})},withSysMonitoring:f,updateSysMonitoring:e=>E(e),validation:h})),v=l.a.createElement(c.EuiFlyoutFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{onClick:()=>e(),flush:"left"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.cancelButtonLabel",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,isLoading:m,isDisabled:!s||m||Object.keys(h).length>0,onClick:async()=>{p(!0);try{const{data:t,error:a}=await(async()=>await Object(o.i)(r,{withSysMonitoring:f}))();p(!1),t?(i.toasts.addSuccess(d.i18n.translate("xpack.fleet.createAgentPolicy.successNotificationTitle",{defaultMessage:"Agent policy '{name}' created",values:{name:r.name}})),e(t.item)):i.toasts.addDanger(a?a.message:d.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"}))}catch(e){p(!1),i.toasts.addDanger(d.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"}))}}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.submitButtonLabel",defaultMessage:"Create agent policy"})))));return l.a.createElement(S,O()({onClose:()=>e(),size:"l",maxWidth:400},a),b,y,v)},I=()=>{var e,t;Object(o.L)("policies_list");const{getPath:a}=Object(o.db)(),i=Object(o.M)().write,{agents:{enabled:s}}=Object(o.N)(),{urlParams:g,toUrlParams:m}=Object(o.mb)(),[p,f]=Object(n.useState)(Array.isArray(g.kuery)?g.kuery[g.kuery.length-1]:null!==(e=g.kuery)&&void 0!==e?e:""),{pagination:E,pageSizeOptions:h,setPagination:b}=Object(o.fb)(),{sorting:k,setSorting:M}=Object(o.ib)({field:"updated_at",direction:"desc"}),O=Object(r.useHistory)(),j="create"in g,S=Object(n.useCallback)((e=>{if(e!==j)if(e)O.push(`${a("policies_list")}?${m({...g,create:null})}`);else{const{create:e,...t}=g;O.push(`${a("policies_list")}?${m(t)}`)}}),[a,O,j,m,g]),{isLoading:I,data:T,resendRequest:P}=Object(o.Q)({page:E.currentPage,perPage:E.pageSize,sortField:null==k?void 0:k.field,sortOrder:null==k?void 0:k.direction,kuery:p}),w=Object(n.useMemo)((()=>{const e=[{field:"name",sortable:!0,name:d.i18n.translate("xpack.fleet.agentPolicyList.nameColumnTitle",{defaultMessage:"Name"}),width:"20%",render:(e,t)=>l.a.createElement(y.d,{policy:t})},{field:"description",name:d.i18n.translate("xpack.fleet.agentPolicyList.descriptionColumnTitle",{defaultMessage:"Description"}),width:"35%",render:e=>l.a.createElement(c.EuiTextColor,{color:"subdued",className:"eui-textTruncate",title:e},e)},{field:"updated_at",sortable:!0,name:d.i18n.translate("xpack.fleet.agentPolicyList.updatedOnColumnTitle",{defaultMessage:"Last updated on"}),render:e=>l.a.createElement(u.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"})},{field:"agents",name:d.i18n.translate("xpack.fleet.agentPolicyList.agentsColumnTitle",{defaultMessage:"Agents"}),dataType:"number",render:(e,t)=>l.a.createElement(x.d,{count:e,agentPolicyId:t.id})},{field:"package_policies",name:d.i18n.translate("xpack.fleet.agentPolicyList.packagePoliciesCountColumnTitle",{defaultMessage:"Integrations"}),dataType:"number",render:e=>e?e.length:0},{name:d.i18n.translate("xpack.fleet.agentPolicyList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>l.a.createElement(x.a,{agentPolicy:e,onCopySuccess:()=>P()})}]}];return s?e:e.filter((e=>!("field"in e)||"agents"!==e.field))}),[s,P]),C=Object(n.useMemo)((()=>l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",isDisabled:!i,onClick:()=>S(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.addButton",defaultMessage:"Create agent policy"}))),[i,S]),A=Object(n.useMemo)((()=>l.a.createElement(c.EuiEmptyPrompt,{title:l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.noAgentPoliciesPrompt",defaultMessage:"No agent policies"})),actions:C})),[C]);return l.a.createElement(l.a.Fragment,null,j?l.a.createElement(F,{onClose:()=>{S(!1),P()}}):null,l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"m"},l.a.createElement(c.EuiFlexItem,{grow:4},l.a.createElement(y.o,{value:p,onChange:e=>{b({...E,currentPage:1}),f(e)},fieldPrefix:v.b})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"primary",iconType:"refresh",onClick:()=>P()},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.reloadAgentPoliciesButtonText",defaultMessage:"Reload"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},C)),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiBasicTable,{loading:I,hasActions:!0,noItemsMessage:I?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.loadingAgentPoliciesMessage",defaultMessage:"Loading agent policies…"}):p.trim()||0!==(null!==(t=null==T?void 0:T.total)&&void 0!==t?t:0)?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.noFilteredAgentPoliciesPrompt",defaultMessage:"No agent policies found. {clearFiltersLink}",values:{clearFiltersLink:l.a.createElement(c.EuiLink,{onClick:()=>f("")},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.clearFiltersLinkText",defaultMessage:"Clear filters"}))}}):A,items:T?T.items:[],itemId:"id",columns:w,isSelectable:!1,pagination:{pageIndex:E.currentPage-1,pageSize:E.pageSize,totalItemCount:T?T.total:0,pageSizeOptions:h},sorting:{sort:k},onChange:e=>{const t={...E,currentPage:e.page.index+1,pageSize:e.page.size};b(t),M(e.sort)}}))};var T=a(85);const P=l.a.createContext({refresh:()=>{}});var w=a(7);const C=(e,t)=>e.localeCompare(t),A=e=>({name:e,value:e}),L=({packagePolicies:e,agentPolicy:t,...a})=>{const{application:i}=Object(o.jb)(),s=Object(o.M)().write,{updatableIntegrations:r}=Object(o.eb)(),{getHref:g}=Object(o.db)(),[m,p]=Object(n.useMemo)((()=>{const t=new Set;return[e.map((e=>{var a,n,l,i,s,o,c,u;e.namespace&&t.add(e.namespace);const d=r.get(null!==(a=null===(n=e.package)||void 0===n?void 0:n.name)&&void 0!==a?a:""),g=!!d&&d.policiesToUpgrade.some((({pkgPolicyId:t})=>t===e.id));return{...e,packageName:null!==(l=null===(i=e.package)||void 0===i?void 0:i.name)&&void 0!==l?l:"",packageTitle:null!==(s=null===(o=e.package)||void 0===o?void 0:o.title)&&void 0!==s?s:"",packageVersion:null!==(c=null===(u=e.package)||void 0===u?void 0:u.version)&&void 0!==c?c:"",hasUpgrade:g}})),[...t].sort(C).map(A)]}),[e,r]),f=Object(n.useMemo)((()=>[{field:"name",sortable:!0,truncateText:!0,name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.nameColumnTitle",{defaultMessage:"Name"}),render:(e,a)=>l.a.createElement(c.EuiLink,O()({title:e},s?{href:g("edit_integration",{policyId:t.id,packagePolicyId:a.id})}:{disabled:!0}),l.a.createElement("span",{className:"eui-textTruncate",title:e},e),a.description?l.a.createElement("span",null," ",l.a.createElement(c.EuiToolTip,{content:a.description},l.a.createElement(c.EuiIcon,{type:"help"}))):null)},{field:"packageTitle",sortable:!0,name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.packageNameColumnTitle",{defaultMessage:"Integration"}),render:(e,a)=>l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiLink,{href:a.package&&g("integration_details_overview",{pkgkey:Object(T.m)(a.package)})},l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},a.package&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(y.m,{packageName:a.package.name,version:a.package.version,size:"m",tryApi:!0})),l.a.createElement(c.EuiFlexItem,{grow:!1},e),a.package&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.packagePoliciesTable.packageVersion",defaultMessage:"v{version}",values:{version:a.package.version}})))))),a.hasUpgrade&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiToolTip,{content:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.upgradeAvailable",{defaultMessage:"Upgrade Available"})},l.a.createElement(c.EuiIcon,{type:"alert",color:"warning"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{size:"s",minWidth:"0",href:`${g("upgrade_package_policy",{policyId:t.id,packagePolicyId:a.id})}?from=fleet-policy-list`},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.packagePoliciesTable.upgradeButton",defaultMessage:"Upgrade"})))))},{field:"namespace",name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.namespaceColumnTitle",{defaultMessage:"Namespace"}),render:e=>e?l.a.createElement(c.EuiBadge,{color:"hollow"},e):""},{name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>l.a.createElement(y.n,{agentPolicy:t,packagePolicy:e,upgradePackagePolicyHref:`${g("upgrade_package_policy",{policyId:t.id,packagePolicyId:e.id})}?from=fleet-policy-list`})}]}]),[t,g,s]);return l.a.createElement(c.EuiInMemoryTable,O()({itemId:"id",items:m,columns:f,sorting:{sort:{field:"name",direction:"asc"}}},a,{search:{toolsRight:t.is_managed?[]:[l.a.createElement(c.EuiButton,{key:"addPackagePolicyButton",fill:!0,isDisabled:!s,iconType:"plusInCircle",onClick:()=>{i.navigateToApp(j.INTEGRATIONS_PLUGIN_ID,{path:w.s.integrations_all({})[1],state:{forAgentPolicyId:t.id}})}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.addPackagePolicyButtonText",defaultMessage:"Add integration"}))],box:{incremental:!0,schema:!0},filters:[{type:"field_value_selection",field:"namespace",name:"Namespace",options:p,multiSelect:"or",operator:"exact"}]},isSelectable:!1}))},_=Object(n.memo)((({policyId:e})=>{const{application:t}=Object(o.jb)(),a=Object(o.M)().write;return l.a.createElement(c.EuiEmptyPrompt,{iconType:"plusInCircle",title:l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstTitle",defaultMessage:"Add your first integration"})),body:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstMessage",defaultMessage:"This policy does not have any integrations yet."}),actions:l.a.createElement(c.EuiButton,{isDisabled:!a,fill:!0,onClick:()=>t.navigateToApp(v.j,{path:v.l.integrations_all({})[1],state:{forAgentPolicyId:e}})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstButtonText",defaultMessage:"Add integration"}))})})),D=Object(n.memo)((({agentPolicy:e})=>(Object(o.L)("policy_details",{policyName:e.name}),0===e.package_policies.length?l.a.createElement(_,{policyId:e.id}):l.a.createElement(L,{agentPolicy:e,packagePolicies:e.package_policies||[]})))),N=m.a.div.withConfig({displayName:"FormWrapper",componentId:"sc-1b9jodr-0"})(["max-width:800px;margin-right:auto;margin-left:auto;"]),B=Object(n.memo)((({agentPolicy:e})=>{Object(o.L)("policy_details",{policyName:e.name});const{notifications:t}=Object(o.jb)(),{agents:{enabled:a}}=Object(o.N)(),i=Object(r.useHistory)(),{getPath:s}=Object(o.db)(),g=Object(o.M)().write,m=Object(o.K)(),[p,f]=Object(n.useState)({...e}),[E,h]=Object(n.useState)(!1),[b,y]=Object(n.useState)(!1),[v,k]=Object(n.useState)(0),[M,O]=Object(n.useState)(!0),j=Object(x.e)(p),S=async()=>{h(!0);try{const{name:e,description:a,namespace:n,monitoring_enabled:l,unenroll_timeout:i}=p,{data:s,error:r}=await Object(o.H)(p.id,{name:e,description:a,namespace:n,monitoring_enabled:l,unenroll_timeout:i});s?(t.toasts.addSuccess(d.i18n.translate("xpack.fleet.editAgentPolicy.successNotificationTitle",{defaultMessage:"Successfully updated '{name}' settings",values:{name:p.name}})),m(),y(!1)):t.toasts.addDanger(r?r.message:d.i18n.translate("xpack.fleet.editAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to update agent policy"}))}catch(e){t.toasts.addDanger(d.i18n.translate("xpack.fleet.editAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to update agent policy"}))}h(!1)};return l.a.createElement(N,null,v?l.a.createElement(x.c,{agentCount:v,agentPolicy:p,onConfirm:()=>{k(0),S()},onCancel:()=>{k(0),h(!1)}}):null,l.a.createElement(x.b,{agentPolicy:p,updateAgentPolicy:e=>{f({...p,...e}),y(!0)},withSysMonitoring:M,updateSysMonitoring:e=>O(e),validation:j,isEditing:!0,onDelete:()=>{i.push(s("policies_list"))}}),b?l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiBottomBar,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.unsavedChangesText",defaultMessage:"You have unsaved changes"})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",onClick:()=>{f({...e}),y(!1)}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.cancelButtonText",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{onClick:async()=>{if(a){h(!0);const{data:e}=await Object(o.o)({policyId:p.id});null!=e&&e.results.total?k(e.results.total):await S()}else await S()},isLoading:E,isDisabled:!g||E||Object.keys(j).length>0,iconType:"save",color:"primary",fill:!0},E?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.savingButtonText",defaultMessage:"Saving…"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.saveButtonText",defaultMessage:"Save changes"})))))))):null)})),R=({isLoading:e,policyId:t,agentPolicy:a})=>{const{getHref:n}=Object(o.db)();return l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"s",alignItems:"flexStart"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiButtonEmpty,{iconType:"arrowLeft",href:n("policies_list"),flush:"left",size:"xs"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.viewAgentListTitle",defaultMessage:"View all agent policies"}))),l.a.createElement(c.EuiFlexItem,null,e?l.a.createElement(y.k,null):l.a.createElement(c.EuiFlexGroup,{alignItems:"center",wrap:!0,responsive:!1,gutterSize:"s"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiTitle,null,l.a.createElement("h1",null,a&&a.name||l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.policyDetailsTitle",defaultMessage:"Policy '{id}'",values:{id:t}})))),(null==a?void 0:a.is_managed)&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiIconTip,{title:"Hosted agent policy",content:d.i18n.translate("xpack.fleet.policyDetails.policyDetailsHostedPolicyTooltip",{defaultMessage:"This policy is managed outside of Fleet. Most actions related to this policy are unavailable."}),type:"lock",size:"l",color:"subdued"})))),a&&a.description?l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiText,{color:"subdued",size:"s",className:"eui-textBreakWord"},a.description)):null)},z=m.a.div.withConfig({displayName:"Divider",componentId:"sc-1n9nfzq-0"})(["width:0;height:100%;border-left:",";"],(e=>e.theme.eui.euiBorderThin)),U=({isLoading:e,policyId:t,agentPolicy:a,agentStatus:n,addAgent:i,onCancelEnrollment:s,isAddAgentHelpPopoverOpen:g,setIsAddAgentHelpPopoverOpen:m})=>{var p;const{getPath:f}=Object(o.db)(),E=Object(r.useHistory)();if(!a)return null;const h=l.a.createElement(c.EuiLink,{onClick:i},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.addAgentButton",defaultMessage:"Add agent"}));return l.a.createElement(c.EuiFlexGroup,{justifyContent:"flexEnd",direction:"row"},[{label:d.i18n.translate("xpack.fleet.policyDetails.summary.revision",{defaultMessage:"Revision"}),content:null!==(p=null==a?void 0:a.revision)&&void 0!==p?p:0},{isDivider:!0},{label:d.i18n.translate("xpack.fleet.policyDetails.summary.integrations",{defaultMessage:"Integrations"}),content:l.a.createElement(c.EuiI18nNumber,{value:a&&a.package_policies&&a.package_policies.length||0})},{isDivider:!0},{label:d.i18n.translate("xpack.fleet.policyDetails.summary.usedBy",{defaultMessage:"Agents"}),content:n&&n.total?l.a.createElement(x.d,{count:n.total,agentPolicyId:a&&a.id||"",showAgentText:!0}):null!=a&&a.is_managed?l.a.createElement(x.d,{count:0,agentPolicyId:a&&a.id||"",showAgentText:!0}):l.a.createElement(y.a,{button:h,isOpen:g,offset:15,closePopover:()=>{m(!1)}})},{isDivider:!0},{label:d.i18n.translate("xpack.fleet.policyDetails.summary.lastUpdated",{defaultMessage:"Last updated on"}),content:a&&l.a.createElement(u.FormattedDate,{value:null==a?void 0:a.updated_at,year:"numeric",month:"short",day:"2-digit"})||""},{isDivider:!0},{content:a&&l.a.createElement(x.a,{agentPolicy:a,fullButton:!0,onCopySuccess:e=>{E.push(f("policy_details",{policyId:e.id}))},onCancelEnrollment:s})}].map(((e,t)=>{var a;return l.a.createElement(c.EuiFlexItem,{grow:!1,key:t},null!==(a=e.isDivider)&&void 0!==a&&a?l.a.createElement(z,null):e.label?l.a.createElement(c.EuiDescriptionList,{compressed:!0,textStyle:"reverse",style:{textAlign:"right"}},l.a.createElement(c.EuiDescriptionListTitle,{className:"eui-textNoWrap"},e.label),l.a.createElement(c.EuiDescriptionListDescription,{className:"eui-textNoWrap"},e.content)):e.content)})))},q=()=>{var e;const{params:{policyId:t,tabId:a=""}}=Object(r.useRouteMatch)(),{getHref:i}=Object(o.db)(),s=Object(o.U)(t),g=s.data?s.data.item:null,{isLoading:m,error:p,sendRequest:f}=s,E=new URLSearchParams(Object(r.useLocation)().search),h="true"===E.get("openEnrollmentFlyout"),b="true"===E.get("showAddAgentHelp"),[v]=Object(n.useState)(!1),[x,M]=Object(n.useState)(h),[O,j]=Object(n.useState)(b),S=function(e,t){const a=Object(o.hb)({path:T.c.getStatusPath(),query:{policyId:e},method:"get",...t});return{isLoading:a.isLoading,data:a.data,error:a.error,refreshAgentStatus:()=>a.resendRequest}}(t),{refreshAgentStatus:F}=S,{application:{navigateToApp:I}}=Object(o.jb)(),w=Object(o.Z)(),C=null===(e=S.data)||void 0===e?void 0:e.results,{isReady:A}=Object(o.P)(),L=Object(n.useMemo)((()=>{if(w&&w.onDoneNavigateTo&&A){const[e,t]=w.onDoneNavigateTo;return()=>I(e,t)}}),[A,I,w]),_=Object(n.useCallback)((()=>{j(!1),M(!0)}),[]),D=Object(n.useMemo)((()=>[{id:"integrations",name:d.i18n.translate("xpack.fleet.policyDetails.subTabs.packagePoliciesTabText",{defaultMessage:"Integrations"}),href:i("policy_details",{policyId:t,tabId:"integrations"}),isSelected:""===a||"integrations"===a},{id:"settings",name:d.i18n.translate("xpack.fleet.policyDetails.subTabs.settingsTabText",{defaultMessage:"Settings"}),href:i("policy_details",{policyId:t,tabId:"settings"}),isSelected:"settings"===a}]),[i,t,a]),N=Object(n.useMemo)((()=>v?l.a.createElement(r.Redirect,{to:"/"}):m?l.a.createElement(y.k,null):p?l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.unexceptedErrorTitle",defaultMessage:"An error happened while loading the agent policy"}),error:p}):g?l.a.createElement(l.a.Fragment,null,x&&l.a.createElement(c.EuiPortal,null,l.a.createElement(y.b,{agentPolicy:g,onClose:L||(()=>M(!1))})),l.a.createElement(H,{agentPolicy:g})):l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.unexceptedErrorTitle",defaultMessage:"An error happened while loading the agent policy"}),error:d.i18n.translate("xpack.fleet.policyDetails.policyNotFoundErrorTitle",{defaultMessage:"Policy '{id}' not found",values:{id:t}})})),[v,m,p,g,x,L,t]),B=l.a.createElement(R,{agentPolicy:g,policyId:t,isLoading:m}),z=l.a.createElement(U,{agentPolicy:g,agentStatus:C,policyId:t,onCancelEnrollment:L,isLoading:m,isAddAgentHelpPopoverOpen:O,setIsAddAgentHelpPopoverOpen:j,addAgent:_});return l.a.createElement(o.a.Provider,{value:{refresh:f}},l.a.createElement(P.Provider,{value:{refresh:F}},l.a.createElement(k.c,{leftColumn:B,rightColumn:z,tabs:D},N)))},H=({agentPolicy:e})=>(Object(o.L)("policy_details",{policyName:e.name}),l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:v.f.policy_details_settings,render:()=>l.a.createElement(B,{agentPolicy:e})}),l.a.createElement(r.Route,{path:v.f.policy_details,render:()=>l.a.createElement(D,{agentPolicy:e})})));var G=a(123);const V=Object(n.memo)((()=>{const{params:{packagePolicyId:e}}=Object(r.useRouteMatch)(),{search:t}=Object(r.useLocation)(),a=new URLSearchParams(t).get("from");let n;return a&&"fleet-policy-list"===a?n="upgrade-from-fleet-policy-list":a&&"integrations-policy-list"===a&&(n="upgrade-from-integrations-policy-list"),l.a.createElement(G.a,{packagePolicyId:e,from:n,forceUpgrade:!0})})),$=()=>{Object(o.L)("policies");const e=Object(r.useHistory)();return l.a.createElement(r.Router,{history:e},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:v.f.edit_integration},l.a.createElement(G.b,null)),l.a.createElement(r.Route,{path:v.f.upgrade_package_policy},l.a.createElement(V,null)),l.a.createElement(r.Route,{path:v.f.policy_details},l.a.createElement(q,null)),l.a.createElement(r.Route,{path:v.f.policies_list},l.a.createElement(k.a,{section:"agent_policies"},l.a.createElement(I,null)))))},W=Object(n.memo)((({datastream:e})=>{const{dashboards:t}=e,a=[],n=l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.viewDashboardActionText",defaultMessage:"View dashboard"}),i=l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.viewDashboardsActionText",defaultMessage:"View dashboards"}),s=d.i18n.translate("xpack.fleet.dataStreamList.viewDashboardsPanelTitle",{defaultMessage:"View dashboards"});return t&&0!==t.length?1===t.length?a.push({id:0,items:[{icon:"dashboardApp",href:Object(o.ab)(`/dashboard/${t[0].id||""}`),name:n}]}):(a.push({id:0,items:[{icon:"dashboardApp",panel:1,name:i}]}),a.push({id:1,title:s,items:t.map((e=>({icon:"dashboardApp",href:Object(o.ab)(`/dashboard/${e.id||""}`),name:e.title})))})):a.push({id:0,items:[{icon:"dashboardApp",disabled:!0,name:n}]}),l.a.createElement(y.e,{panels:a})})),K=()=>{Object(o.L)("data_streams");const{data:{fieldFormats:e}}=Object(o.jb)(),{pagination:t,pageSizeOptions:a}=Object(o.fb)(),{isLoading:i,data:s,resendRequest:r}=Object(o.R)(),g=Object(n.useMemo)((()=>[{field:"dataset",sortable:!0,width:"25%",name:d.i18n.translate("xpack.fleet.dataStreamList.datasetColumnTitle",{defaultMessage:"Dataset"})},{field:"type",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.typeColumnTitle",{defaultMessage:"Type"})},{field:"namespace",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.namespaceColumnTitle",{defaultMessage:"Namespace"}),render:e=>e?l.a.createElement(c.EuiBadge,{color:"hollow"},e):""},{field:"package",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.integrationColumnTitle",{defaultMessage:"Integration"}),render:(e,t)=>l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},t.package_version&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(y.m,{packageName:e,version:t.package_version,size:"m",tryApi:!0})),l.a.createElement(c.EuiFlexItem,{grow:!1},e))},{field:"last_activity_ms",sortable:!0,width:"25%",dataType:"date",name:d.i18n.translate("xpack.fleet.dataStreamList.lastActivityColumnTitle",{defaultMessage:"Last activity"}),render:t=>{try{return e.getInstance("date",{pattern:"MMM D, YYYY @ HH:mm:ss"}).convert(t)}catch(e){return l.a.createElement(u.FormattedDate,{value:t,year:"numeric",month:"short",day:"2-digit"})}}},{field:"size_in_bytes",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.sizeColumnTitle",{defaultMessage:"Size"}),render:t=>{try{return e.getInstance("bytes").convert(t)}catch(e){return`${t}b`}}},{name:d.i18n.translate("xpack.fleet.dataStreamList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>l.a.createElement(W,{datastream:e})}]}]),[e]),m=Object(n.useMemo)((()=>l.a.createElement(c.EuiEmptyPrompt,{title:l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.noDataStreamsPrompt",defaultMessage:"No data streams"}))})),[]),p={dataset:[],type:[],namespace:[],package:[]};if(s&&s.data_streams.length){const e={dataset:[],type:[],namespace:[],package:[]};s.data_streams.forEach((t=>{const{dataset:a,type:n,namespace:l,package:i}=t;e.dataset.includes(a)||e.dataset.push(a),e.type.includes(n)||e.type.push(n),e.namespace.includes(l)||e.namespace.push(l),e.package.includes(i)||e.package.push(i)}));for(const t in e)p[t]&&(p[t]=e[t].sort().map((e=>({value:e,name:e}))))}return l.a.createElement(c.EuiInMemoryTable,{loading:i,hasActions:!0,tableLayout:"auto",message:i?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.loadingDataStreamsMessage",defaultMessage:"Loading data streams…"}):s&&!s.data_streams.length?m:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.noFilteredDataStreamsMessage",defaultMessage:"No matching data streams found"}),items:s?s.data_streams:[],itemId:"index",columns:g,pagination:{initialPageSize:t.pageSize,pageSizeOptions:a},sorting:!0,search:{toolsRight:[l.a.createElement(c.EuiButton,{key:"reloadButton",color:"primary",iconType:"refresh",onClick:()=>r()},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.reloadDataStreamsButtonText",defaultMessage:"Reload"}))],box:{placeholder:d.i18n.translate("xpack.fleet.dataStreamList.searchPlaceholderTitle",{defaultMessage:"Filter data streams"}),incremental:!0},filters:[{type:"field_value_selection",field:"dataset",name:d.i18n.translate("xpack.fleet.dataStreamList.datasetColumnTitle",{defaultMessage:"Dataset"}),multiSelect:"or",operator:"exact",options:p.dataset},{type:"field_value_selection",field:"type",name:d.i18n.translate("xpack.fleet.dataStreamList.typeColumnTitle",{defaultMessage:"Type"}),multiSelect:"or",operator:"exact",options:p.type},{type:"field_value_selection",field:"namespace",name:d.i18n.translate("xpack.fleet.dataStreamList.namespaceColumnTitle",{defaultMessage:"Namespace"}),multiSelect:"or",operator:"exact",options:p.namespace},{type:"field_value_selection",field:"package",name:d.i18n.translate("xpack.fleet.dataStreamList.integrationColumnTitle",{defaultMessage:"Integration"}),multiSelect:"or",operator:"exact",options:p.package}]}})},Q=()=>{const e=Object(r.useHistory)();return l.a.createElement(r.Router,{history:e},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:v.f.data_streams},l.a.createElement(k.a,{section:"data_streams"},l.a.createElement(K,null)))))},Y=({onClose:e,agents:t})=>{const{notifications:a}=Object(o.jb)(),i=Array.isArray(t)&&1===t.length,[s,r]=Object(n.useState)(i?t[0].policy_id:void 0),g=Object(o.Q)({page:1,perPage:1e3}),m=g.data?g.data.items:[];Object(n.useEffect)((()=>{!s&&m[0]&&r(m[0].id)}),[m,s]);const p=Object(n.useMemo)((()=>m.filter((e=>e&&!e.is_managed)).map((e=>({value:e.id,text:e.name})))),[m]),[f,E]=Object(n.useState)(!1);return l.a.createElement(c.EuiConfirmModal,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentReassignPolicy.flyoutTitle",defaultMessage:"Assign new agent policy"}),onCancel:e,onConfirm:async function(){try{if(E(!0),!s)throw new Error("No selected agent policy id");const n=i?await Object(o.D)(t[0].id,{policy_id:s}):await Object(o.A)({policy_id:s,agents:Array.isArray(t)?t.map((e=>e.id)):t});if(n.error)throw n.error;E(!1);const l=d.i18n.translate("xpack.fleet.agentReassignPolicy.successSingleNotificationTitle",{defaultMessage:"Agent policy reassigned"});a.toasts.addSuccess(l),e()}catch(e){E(!1),a.toasts.addError(e,{title:"Unable to reassign agent policy"})}},cancelButtonText:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentReassignPolicy.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonDisabled:f||i&&s===t[0].policy_id,confirmButtonText:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentReassignPolicy.continueButtonLabel",defaultMessage:"Assign policy"}),buttonColor:"primary"},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentReassignPolicy.flyoutDescription",defaultMessage:"Choose a new agent policy to assign the selected {count, plural, one {agent} other {agents}} to.",values:{count:i?1:0}})),l.a.createElement(c.EuiFlexGroup,null,l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFormRow,{fullWidth:!0,label:d.i18n.translate("xpack.fleet.agentReassignPolicy.selectPolicyLabel",{defaultMessage:"Agent policy"})},l.a.createElement(c.EuiSelect,{fullWidth:!0,isLoading:g.isLoading,options:p,value:s,onChange:e=>r(e.target.value)})))),l.a.createElement(c.EuiSpacer,{size:"l"}),s&&l.a.createElement(y.c,{agentPolicyId:s}))};var Z=a(75);const J={Healthy:l.a.createElement(c.EuiBadge,{color:"secondary"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentHealth.healthyStatusText",defaultMessage:"Healthy"})),Offline:l.a.createElement(c.EuiBadge,{color:"default"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentHealth.offlineStatusText",defaultMessage:"Offline"})),Inactive:l.a.createElement(c.EuiBadge,{color:Z.euiLightVars.euiColorDarkShade},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentHealth.inactiveStatusText",defaultMessage:"Inactive"})),Unhealthy:l.a.createElement(c.EuiBadge,{color:"warning"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentHealth.unhealthyStatusText",defaultMessage:"Unhealthy"})),Updating:l.a.createElement(c.EuiBadge,{color:"primary"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentHealth.updatingStatusText",defaultMessage:"Updating"}))};const X=({agent:e})=>{const{last_checkin:t}=e,a=new Date(t||0).getTime();return l.a.createElement(c.EuiToolTip,{position:"top",content:a?l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentHealth.checkInTooltipText",defaultMessage:"Last checked in {lastCheckIn}",values:{lastCheckIn:l.a.createElement(u.FormattedRelative,{value:a})}})):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentHealth.noCheckInTooltipText",defaultMessage:"Never checked in"})},function(e){switch(e.status){case"warning":case"error":case"degraded":return J.Unhealthy;case"inactive":return J.Inactive;case"offline":return J.Offline;case"unenrolling":case"enrolling":case"updating":return J.Updating;default:return J.Healthy}}(e))},ee=({onClose:e,agents:t,agentCount:a,useForceUnenroll:i,hasFleetServer:s=!1})=>{const{notifications:r}=Object(o.jb)(),[g,m]=Object(n.useState)(i||!1),[p,f]=Object(n.useState)(!1),E=Array.isArray(t)&&1===t.length;return l.a.createElement(c.EuiConfirmModal,{title:E?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.unenrollAgents.deleteSingleTitle",defaultMessage:"Unenroll agent"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.unenrollAgents.forceDeleteMultipleTitle",defaultMessage:"Unenroll {count} agents",values:{count:a}}),onCancel:e,onConfirm:async function(){try{f(!0);const{error:a}=E?await Object(o.y)(t[0].id,{revoke:g}):await Object(o.B)({agents:Array.isArray(t)?t.map((e=>e.id)):t,revoke:g});if(a)throw a;if(f(!1),g){const e=E?d.i18n.translate("xpack.fleet.unenrollAgents.successForceSingleNotificationTitle",{defaultMessage:"Agent unenrolled"}):d.i18n.translate("xpack.fleet.unenrollAgents.successForceMultiNotificationTitle",{defaultMessage:"Agents unenrolled"});r.toasts.addSuccess(e)}else{const e=E?d.i18n.translate("xpack.fleet.unenrollAgents.successSingleNotificationTitle",{defaultMessage:"Unenrolling agent"}):d.i18n.translate("xpack.fleet.unenrollAgents.successMultiNotificationTitle",{defaultMessage:"Unenrolling agents"});r.toasts.addSuccess(e)}e()}catch(e){f(!1),r.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.unenrollAgents.fatalErrorNotificationTitle",{defaultMessage:"Error unenrolling {count, plural, one {agent} other {agents}}",values:{count:a}})})}},cancelButtonText:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.unenrollAgents.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonDisabled:p,confirmButtonText:E?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.unenrollAgents.confirmSingleButtonLabel",defaultMessage:"Unenroll agent"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.unenrollAgents.confirmMultipleButtonLabel",defaultMessage:"Unenroll {count} agents",values:{count:a}}),buttonColor:"danger"},l.a.createElement("p",null,s&&E?l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiCallOut,{title:d.i18n.translate("xpack.fleet.unenrollAgents.unenrollFleetServerTitle",{defaultMessage:"This agent is running Fleet Server"}),color:"warning",iconType:"alert"},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.unenrollAgents.unenrollFleetServerDescription",defaultMessage:"Unenrolling this agent will disconnect a Fleet Server and prevent agents from sending data if no other Fleet Servers exist."}))),l.a.createElement(c.EuiSpacer,null)):null,E?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.unenrollAgents.deleteSingleDescription",defaultMessage:'This action will remove the selected agent running on "{hostName}" from Fleet. Any data that was already sent by the agent will not be deleted. This action cannot be undone.',values:{hostName:t[0].local_metadata.host.hostname}}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.unenrollAgents.deleteMultipleDescription",defaultMessage:"This action will remove multiple agents from Fleet and prevent new data from being ingested. Any data that was already sent by these agents will not be affected. This action cannot be undone."})),l.a.createElement(c.EuiFormFieldset,{legend:{children:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.unenrollAgents.forceUnenrollLegendText",defaultMessage:"Force unenroll {count, plural, one {agent} other {agents}}",values:{count:a}})}},l.a.createElement(c.EuiCheckbox,{id:"fleetForceUnenrollAgents",label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.unenrollAgents.forceUnenrollCheckboxLabel",defaultMessage:"Remove {count, plural, one {agent} other {agents}} immediately. Do not wait for agent to send any last data.",values:{count:a}}),checked:g,onChange:e=>m(e.target.checked),disabled:i})))},te=({onClose:e,agents:t,agentCount:a,version:i})=>{const{notifications:s}=Object(o.jb)(),[r,g]=Object(n.useState)(!1),m=Array.isArray(t)&&1===t.length,p=""===t;return l.a.createElement(c.EuiConfirmModal,{title:l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:!1},m?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.upgradeAgents.upgradeSingleTitle",defaultMessage:"Upgrade agent to latest version"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.upgradeAgents.upgradeMultipleTitle",defaultMessage:"Upgrade {count, plural, one {agent} other {{count} agents} =true {all selected agents}} to latest version",values:{count:p||a}})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiBetaBadge,{iconType:"beaker",label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.upgradeAgents.experimentalLabel",defaultMessage:"Experimental"}),tooltipContent:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.upgradeAgents.experimentalLabelTooltip",defaultMessage:"Upgrade agent might change or be removed in a future release and is not subject to the support SLA."})}))),onCancel:e,onConfirm:async function(){try{g(!0);const{data:n,error:l}=m?await Object(o.z)(t[0].id,{version:i}):await Object(o.C)({agents:Array.isArray(t)?t.map((e=>e.id)):t,version:i});if(l)throw l;const r=Object.entries(n||{}).reduce(((e,[t,a])=>(++e.total,++e[a.success?"success":"error"],e)),{total:0,success:0,error:0});g(!1);const c=m?d.i18n.translate("xpack.fleet.upgradeAgents.successSingleNotificationTitle",{defaultMessage:"Upgraded {count} agent",values:{count:1}}):d.i18n.translate("xpack.fleet.upgradeAgents.successMultiNotificationTitle",{defaultMessage:"Upgraded {isMixed, select, true {{success} of {total}} other {{isAllAgents, select, true {all selected} other {{success}} }}} agents",values:{isMixed:r.success!==r.total,success:r.success,total:r.total,isAllAgents:p}});r.success===r.total?s.toasts.addSuccess(c):r.error===r.total?s.toasts.addDanger(d.i18n.translate("xpack.fleet.upgradeAgents.bulkResultAllErrorsNotificationTitle",{defaultMessage:"Error upgrading {count, plural, one {agent} other {{count} agents} =true {all selected agents}}",values:{count:p||a}})):s.toasts.addWarning({title:c,text:d.i18n.translate("xpack.fleet.upgradeAgents.bulkResultErrorResultsSummary",{defaultMessage:"{count} {count, plural, one {agent was} other {agents were}} not successful",values:{count:r.error}})}),e()}catch(e){g(!1),s.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.upgradeAgents.fatalErrorNotificationTitle",{defaultMessage:"Error upgrading {count, plural, one {agent} other {{count} agents} =true {all selected agents}}",values:{count:p||a}})})}},cancelButtonText:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.upgradeAgents.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonDisabled:r,confirmButtonText:m?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.upgradeAgents.confirmSingleButtonLabel",defaultMessage:"Upgrade agent"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.upgradeAgents.confirmMultipleButtonLabel",defaultMessage:"Upgrade {count, plural, one {agent} other {{count} agents} =true {all selected agents}}",values:{count:p||a}})},l.a.createElement("p",null,m?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.upgradeAgents.upgradeSingleDescription",defaultMessage:"This action will upgrade the agent running on '{hostName}' to version {version}. This action can not be undone. Are you sure you wish to continue?",values:{hostName:t[0].local_metadata.host.hostname,version:i}}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.upgradeAgents.upgradeMultipleDescription",defaultMessage:"This action will upgrade multiple agents to version {version}. This action can not be undone. Are you sure you wish to continue?",values:{version:i}})))},ae=Object(c.euiPaletteColorBlindBehindText)(),ne={default:Z.euiLightVars.euiColorLightShade,primary:ae[1],secondary:ae[0],accent:ae[2],warning:ae[5],danger:ae[9],inactive:Z.euiLightVars.euiColorDarkShade},le=["healthy","unhealthy","updating","offline","inactive"];function ie(e){switch(e){case"healthy":return ne.secondary;case"offline":return ne.default;case"inactive":return ne.inactive;case"unhealthy":return ne.warning;case"updating":return ne.primary;default:throw new Error(`Insuported Agent status ${e}`)}}const se=m()(c.EuiColorPaletteDisplay).withConfig({displayName:"StyledEuiColorPaletteDisplay",componentId:"sc-147tmhq-0"})(["&.ingest-agent-status-bar{border:none;border-radius:0;&:after{border:none;}}"]),re=({agentStatus:e})=>{const t=Object(n.useMemo)((()=>le.reduce(((t,a)=>{const n=t.length>0?t[t.length-1].stop:0;return t.push({stop:n+(e[a]||0),color:ie(a)}),t}),[])),[e]);return l.a.createElement(l.a.Fragment,null,l.a.createElement(se,{className:"ingest-agent-status-bar",size:"s",palette:t}))},oe=m.a.div.withConfig({displayName:"Divider",componentId:"sc-1ynhme7-0"})(["width:0;height:",";border-left:",";"],(e=>e.theme.eui.euiSizeL),(e=>e.theme.eui.euiBorderThin)),ce=m()(c.EuiFlexItem).withConfig({displayName:"FlexItem",componentId:"sc-1ynhme7-1"})(["height:",";"],(e=>e.theme.eui.euiSizeL)),ue=m()(c.EuiButtonEmpty).withConfig({displayName:"Button",componentId:"sc-1ynhme7-2"})([".euiButtonEmpty__text{font-size:",";}"],(e=>e.theme.eui.euiFontSizeXS)),de=({totalAgents:e,totalInactiveAgents:t,selectableAgents:a,selectionMode:i,setSelectionMode:s,currentQuery:r,selectedAgents:d,setSelectedAgents:g,refreshAgents:m})=>{const p=Object(o.bb)(),[f,E]=Object(n.useState)(!1),h=()=>E(!1),[b,y]=Object(n.useState)(!1),[k,x]=Object(n.useState)(!1),[M,O]=Object(n.useState)(!1),j="manual"===i?!!d.find((e=>e.active)):e>t,S=[{id:0,items:[{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.reassignPolicy",defaultMessage:"Assign to new policy"}),icon:l.a.createElement(c.EuiIcon,{type:"pencil",size:"m"}),disabled:!j,onClick:()=>{h(),y(!0)}},{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.unenrollAgents",defaultMessage:"Unenroll agents"}),icon:l.a.createElement(c.EuiIcon,{type:"trash",size:"m"}),disabled:!j,onClick:()=>{h(),x(!0)}},{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.upgradeAgents",defaultMessage:"Upgrade agents"}),icon:l.a.createElement(c.EuiIcon,{type:"refresh",size:"m"}),disabled:!j,onClick:()=>{h(),O(!0)}},{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.clearSelection",defaultMessage:"Clear selection"}),icon:l.a.createElement(c.EuiIcon,{type:"cross",size:"m"}),onClick:()=>{h(),s("manual"),g([])}}]}],F="manual"===i&&d.length===a&&a<e,I=e-t,T="manual"===i?d.length:I,P="manual"===i?d:r;return l.a.createElement(l.a.Fragment,null,b&&l.a.createElement(c.EuiPortal,null,l.a.createElement(Y,{agents:P,onClose:()=>{y(!1),m()}})),k&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ee,{agents:P,agentCount:T,onClose:()=>{x(!1),m()}})),M&&l.a.createElement(c.EuiPortal,null,l.a.createElement(te,{version:p,agents:P,agentCount:T,onClose:()=>{O(!1),m()}})),l.a.createElement(c.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{size:"xs",color:"subdued"},e>v.k?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.totalAgentsWithLimit",defaultMessage:"Showing {count} of {total} agents",values:{count:l.a.createElement(u.FormattedNumber,{value:v.k}),total:l.a.createElement(u.FormattedNumber,{value:e})}}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.totalAgents",defaultMessage:"Showing {count, plural, one {# agent} other {# agents}}",values:{count:e}}))),"manual"===i&&d.length||"query"===i&&e>0?l.a.createElement(l.a.Fragment,null,l.a.createElement(ce,{grow:!1},l.a.createElement(oe,null)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiPopover,{id:"agentBulkActionsMenu",button:l.a.createElement(ue,{size:"xs",iconType:"arrowDown",iconSide:"right",flush:"left",onClick:()=>E(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.agentsSelected",defaultMessage:"{count, plural, one {# agent} other {# agents} =all {All agents}} selected",values:{count:"manual"===i?d.length:"all"}})),isOpen:f,closePopover:h,panelPaddingSize:"none",anchorPosition:"downLeft"},l.a.createElement(c.EuiContextMenu,{initialPanelId:0,panels:S}))),F?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(ue,{size:"xs",iconType:"pagesSelect",iconSide:"left",flush:"left",onClick:()=>s("query")},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.selectAll",defaultMessage:"Select everything on all pages"}))):null):l.a.createElement(ce,{grow:!1})))},ge=Object(n.memo)((({agentStatus:e,showInactive:t})=>{const a=Object(n.useMemo)((()=>le.filter((e=>!!t||"inactive"!==e))),[t]);return l.a.createElement(c.EuiFlexGroup,{gutterSize:"m"},a.map((t=>l.a.createElement(c.EuiFlexItem,{key:t,grow:!1},l.a.createElement(me,{status:t,count:e[t]||0})))))})),me=Object(n.memo)((({status:e,count:t})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiHealth,{color:ie(e)},l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:!1},function(e){switch(e){case"healthy":return d.i18n.translate("xpack.fleet.agentStatus.healthyLabel",{defaultMessage:"Healthy"});case"offline":return d.i18n.translate("xpack.fleet.agentStatus.offlineLabel",{defaultMessage:"Offline"});case"inactive":return d.i18n.translate("xpack.fleet.agentStatus.inactiveLabel",{defaultMessage:"Inactive"});case"unhealthy":return d.i18n.translate("xpack.fleet.agentStatus.unhealthyLabel",{defaultMessage:"Unhealthy"});case"updating":return d.i18n.translate("xpack.fleet.agentStatus.updatingLabel",{defaultMessage:"Updating"});default:throw new Error(`Insuported Agent status ${e}`)}}(e)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiNotificationBadge,{size:"s",color:"subdued"},t))))))),pe=({agentStatus:e,totalAgents:t,totalInactiveAgents:a,selectableAgents:n,selectionMode:i,setSelectionMode:s,currentQuery:r,selectedAgents:o,setSelectedAgents:u,refreshAgents:d,showInactive:g})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(de,{totalAgents:t,totalInactiveAgents:a,selectableAgents:n,selectionMode:i,setSelectionMode:s,currentQuery:r,selectedAgents:o,setSelectedAgents:u,refreshAgents:d})),l.a.createElement(c.EuiFlexItem,{grow:!1},e&&l.a.createElement(ge,{showInactive:g,agentStatus:e}))),l.a.createElement(c.EuiSpacer,{size:"s"}),e&&l.a.createElement(re,{agentStatus:e})),fe=[{status:"healthy",label:d.i18n.translate("xpack.fleet.agentList.statusHealthyFilterText",{defaultMessage:"Healthy"})},{status:"unhealthy",label:d.i18n.translate("xpack.fleet.agentList.statusUnhealthyFilterText",{defaultMessage:"Unhealthy"})},{status:"updating",label:d.i18n.translate("xpack.fleet.agentList.statusUpdatingFilterText",{defaultMessage:"Updating"})},{status:"offline",label:d.i18n.translate("xpack.fleet.agentList.statusOfflineFilterText",{defaultMessage:"Offline"})},{status:"inactive",label:d.i18n.translate("xpack.fleet.agentList.statusInactiveFilterText",{defaultMessage:"Inactive"})}],Ee=({agentPolicies:e,draftKuery:t,onDraftKueryChange:a,onSubmitSearch:i,selectedAgentPolicies:s,onSelectedAgentPoliciesChange:r,selectedStatus:o,onSelectedStatusChange:d,showUpgradeable:g,onShowUpgradeableChange:m})=>{const[p,f]=Object(n.useState)(!1),[E,h]=Object(n.useState)(!1),[b,k]=Object(n.useState)(!1);return l.a.createElement(l.a.Fragment,null,p?l.a.createElement(c.EuiPortal,null,l.a.createElement(y.b,{agentPolicies:e,onClose:()=>f(!1)})):null,l.a.createElement(c.EuiFlexGroup,{alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:4},l.a.createElement(c.EuiFlexGroup,{gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:6},l.a.createElement(y.o,{value:t,onChange:(e,t)=>{a(e),t&&i(e)},indexPattern:v.a})),l.a.createElement(c.EuiFlexItem,{grow:2},l.a.createElement(c.EuiFilterGroup,null,l.a.createElement(c.EuiPopover,{ownFocus:!0,button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:()=>k(!b),isSelected:b,hasActiveFilters:o.length>0,disabled:0===e.length},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.statusFilterText",defaultMessage:"Status"})),isOpen:b,closePopover:()=>k(!1),panelPaddingSize:"none"},l.a.createElement("div",{className:"euiFilterSelect__items"},fe.map((({label:e,status:t},a)=>l.a.createElement(c.EuiFilterSelectItem,{key:a,checked:o.includes(t)?"on":void 0,onClick:()=>{o.includes(t)?d([...o.filter((e=>e!==t))]):d([...o,t])}},e))))),l.a.createElement(c.EuiPopover,{ownFocus:!0,button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:()=>h(!E),isSelected:E,hasActiveFilters:s.length>0,numActiveFilters:s.length,numFilters:e.length,disabled:0===e.length},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.policyFilterText",defaultMessage:"Agent policy"})),isOpen:E,closePopover:()=>h(!1),panelPaddingSize:"none"},l.a.createElement("div",{className:"euiFilterSelect__items"},e.map(((e,t)=>l.a.createElement(c.EuiFilterSelectItem,{checked:s.includes(e.id)?"on":void 0,key:t,onClick:()=>{var t;s.includes(e.id)?(t=e.id,r(s.filter((e=>e!==t)))):(e=>{r([...s,e])})(e.id)}},e.name))))),l.a.createElement(c.EuiFilterButton,{hasActiveFilters:g,onClick:()=>{m(!g)}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.showUpgradeableFilterLabel",defaultMessage:"Upgrade available"})))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>f(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addButton",defaultMessage:"Add agent"})))))))},he=l.a.memo((({agent:e,agentPolicy:t,refresh:a,onReassignClick:i,onUnenrollClick:s,onUpgradeClick:r})=>{const{getHref:d}=Object(o.db)(),g=Object(o.M)().write,m="unenrolling"===e.status,p=Object(o.bb)(),[f,E]=Object(n.useState)(!1),h=[l.a.createElement(c.EuiContextMenuItem,{icon:"inspect",href:d("agent_details",{agentId:e.id}),key:"viewAgent"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.viewActionText",defaultMessage:"View agent"}))];return!1===(null==t?void 0:t.is_managed)&&h.push(l.a.createElement(c.EuiContextMenuItem,{icon:"pencil",onClick:()=>{i()},disabled:!e.active,key:"reassignPolicy"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.reassignActionText",defaultMessage:"Assign to new policy"})),l.a.createElement(c.EuiContextMenuItem,{disabled:!g||!e.active,icon:"trash",onClick:()=>{s()}},m?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.forceUnenrollOneButton",defaultMessage:"Force unenroll"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.unenrollOneButton",defaultMessage:"Unenroll agent"})),l.a.createElement(c.EuiContextMenuItem,{icon:"refresh",disabled:!Object(T.i)(e,p),onClick:()=>{r()}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.upgradeOneButton",defaultMessage:"Upgrade agent"}))),l.a.createElement(y.e,{isOpen:f,onChange:e=>E(e),items:h})}));function be(e){return"string"!=typeof e?"-":e}const ye=()=>{const{notifications:e}=Object(o.jb)();Object(o.L)("agent_list");const{getHref:t}=Object(o.db)(),a=Object(o.mb)().urlParams.kuery||"",i=Object(o.M)().write,s=Object(o.cb)().isGoldPlus(),r=Object(o.bb)(),[g,m]=Object(n.useState)(!1),[p,f]=Object(n.useState)(a),[E,h]=Object(n.useState)(a),[b,k]=Object(n.useState)("manual"),[x,M]=Object(n.useState)([]),O=Object(n.useRef)(null),{pagination:j,pageSizeOptions:S,setPagination:F}=Object(o.fb)(),I=Object(n.useCallback)((e=>{h(e),F({...j,currentPage:1})}),[h,j,F]),[P,w]=Object(n.useState)([]),[C,A]=Object(n.useState)([]),L=E.trim()||P.length||C.length||g,_=Object(n.useCallback)((()=>{f(""),h(""),w([]),A([]),m(!1)}),[h,f,w,A,m]),[D,N]=Object(n.useState)(!1),[B,R]=Object(n.useState)(void 0),[z,U]=Object(n.useState)(void 0),[q,H]=Object(n.useState)(void 0),G=Object(n.useMemo)((()=>{let e=E.trim();if(P.length&&(e&&(e=`(${e}) and`),e=`${e} ${v.c}.policy_id : (${P.map((e=>`"${e}"`)).join(" or ")})`),C.length){const t=C.map((e=>{switch(e){case"healthy":return T.a.buildKueryForOnlineAgents();case"unhealthy":return T.a.buildKueryForErrorAgents();case"offline":return T.a.buildKueryForOfflineAgents();case"updating":return T.a.buildKueryForUpdatingAgents();case"inactive":return T.a.buildKueryForInactiveAgents()}})).filter((e=>void 0!==e)).join(" or ");e=e?`(${e}) and (${t})`:t}return e}),[C,P,E]),V=Object(n.useMemo)((()=>C.includes("inactive")),[C]),[$,W]=Object(n.useState)([]),[K,Q]=Object(n.useState)(),[Z,J]=Object(n.useState)(!1),[ae,ne]=Object(n.useState)(0),[le,ie]=Object(n.useState)(0),se=Object(n.useRef)(0),re=Object(n.useCallback)((()=>{!async function(){se.current++;const t=se.current;try{J(!0);const[e,a]=await Promise.all([Object(o.p)({page:j.currentPage,perPage:j.pageSize,kuery:G&&""!==G?G:void 0,showInactive:V,showUpgradeable:g}),Object(o.o)({kuery:G&&""!==G?G:void 0})]);if(se.current!==t)return;if(e.error)throw e.error;if(!e.data)throw new Error("Invalid GET /agents response");if(a.error)throw a.error;if(!a.data)throw new Error("Invalid GET /agents-status response");Q({healthy:a.data.results.online,unhealthy:a.data.results.error,offline:a.data.results.offline,updating:a.data.results.updating,inactive:e.data.totalInactive}),W(e.data.list),ne(e.data.total),ie(e.data.totalInactive)}catch(t){e.toasts.addError(t,{title:d.i18n.translate("xpack.fleet.agentList.errorFetchingDataTitle",{defaultMessage:"Error fetching agents"})})}J(!1)}()}),[j,G,V,g,e.toasts]);Object(n.useEffect)((()=>{re();const e=setInterval((()=>{re()}),3e4);return()=>clearInterval(e)}),[re]);const oe=Object(o.Q)({page:1,perPage:1e3,full:!0}),ce=Object(n.useMemo)((()=>oe.data?oe.data.items:[]),[oe]),ue=Object(n.useMemo)((()=>ce.reduce(((e,t)=>(e[t.id]=t,e)),{})),[ce]),de=e=>{if(!e.active)return!1;if(!e.policy_id)return!0;const t=ue[e.policy_id];return!(!0===(null==t?void 0:t.is_managed))},ge=Object(n.useMemo)((()=>{if(!z||!z.policy_id)return!1;const e=ue[z.policy_id];return!!e&&e.package_policies.some((e=>{var t;return"string"!=typeof e&&(null===(t=e.package)||void 0===t?void 0:t.name)===v.g}))}),[z,ue]),me=[{field:"local_metadata.host.hostname",name:d.i18n.translate("xpack.fleet.agentList.hostColumnTitle",{defaultMessage:"Host"}),render:(e,a)=>l.a.createElement(c.EuiLink,{href:t("agent_details",{agentId:a.id})},be(e))},{field:"active",width:"120px",name:d.i18n.translate("xpack.fleet.agentList.statusColumnTitle",{defaultMessage:"Status"}),render:(e,t)=>l.a.createElement(X,{agent:t})},{field:"policy_id",name:d.i18n.translate("xpack.fleet.agentList.policyColumnTitle",{defaultMessage:"Agent policy"}),render:(e,t)=>{const a=ue[e],n=t.policy_revision&&(null==a?void 0:a.revision)>t.policy_revision;return l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center",style:{minWidth:0}},a&&l.a.createElement(y.d,{policy:a}),n&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},l.a.createElement(c.EuiIcon,{size:"m",type:"alert",color:"warning"})," ",l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.outOfDateLabel",defaultMessage:"Out-of-date"}))))}},{field:"local_metadata.elastic.agent.version",width:"200px",name:d.i18n.translate("xpack.fleet.agentList.versionTitle",{defaultMessage:"Version"}),render:(e,t)=>l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center",style:{minWidth:0}},l.a.createElement(c.EuiFlexItem,{grow:!1,className:"eui-textNoWrap"},be(e)),de(t)&&Object(T.i)(t,r)?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},l.a.createElement(c.EuiIcon,{size:"m",type:"alert",color:"warning"})," ",l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.agentUpgradeLabel",defaultMessage:"Upgrade available"}))):null)},{field:"last_checkin",name:d.i18n.translate("xpack.fleet.agentList.lastCheckinTitle",{defaultMessage:"Last activity"}),render:(e,t)=>e?l.a.createElement(u.FormattedRelative,{value:e}):null},{name:d.i18n.translate("xpack.fleet.agentList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>{const t="string"==typeof e.policy_id?ue[e.policy_id]:void 0;return l.a.createElement(he,{agent:e,agentPolicy:t,refresh:()=>re(),onReassignClick:()=>R(e),onUnenrollClick:()=>U(e),onUpgradeClick:()=>H(e)})}}],width:"100px"}],fe=l.a.createElement(c.EuiEmptyPrompt,{title:l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.noAgentsPrompt",defaultMessage:"No agents enrolled"})),actions:i?l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>N(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addButton",defaultMessage:"Add agent"})):null});return l.a.createElement(l.a.Fragment,null,D?l.a.createElement(c.EuiPortal,null,l.a.createElement(y.b,{agentPolicies:ce,onClose:()=>N(!1)})):null,B&&l.a.createElement(c.EuiPortal,null,l.a.createElement(Y,{agents:[B],onClose:()=>{R(void 0),re()}})),z&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ee,{agents:[z],agentCount:1,onClose:()=>{U(void 0),re()},useForceUnenroll:"unenrolling"===z.status,hasFleetServer:ge})),q&&l.a.createElement(c.EuiPortal,null,l.a.createElement(te,{agents:[q],agentCount:1,onClose:()=>{H(void 0),re()},version:r})),l.a.createElement(Ee,{agentPolicies:ce,draftKuery:p,onDraftKueryChange:f,onSubmitSearch:I,selectedAgentPolicies:P,onSelectedAgentPoliciesChange:w,selectedStatus:C,onSelectedStatusChange:A,showUpgradeable:g,onShowUpgradeableChange:m}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(pe,{showInactive:V,totalAgents:ae,totalInactiveAgents:le,agentStatus:K,selectableAgents:(null==$?void 0:$.filter(de).length)||0,selectionMode:b,setSelectionMode:k,currentQuery:G,selectedAgents:x,setSelectedAgents:e=>{null!=O&&O.current&&(O.current.setSelection(e),k("manual"))},refreshAgents:()=>re()}),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiBasicTable,{ref:O,className:"fleet__agentList__table","data-test-subj":"fleetAgentListTable",loading:Z,hasActions:!0,noItemsMessage:Z&&1===se.current?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.loadingAgentsMessage",defaultMessage:"Loading agents…"}):L?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.noFilteredAgentsPrompt",defaultMessage:"No agents found. {clearFiltersLink}",values:{clearFiltersLink:l.a.createElement(c.EuiLink,{onClick:()=>_()},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.clearFiltersLinkText",defaultMessage:"Clear filters"}))}}):fe,items:ae?g?$.filter((e=>de(e)&&Object(T.i)(e,r))):$:[],itemId:"id",columns:me,pagination:{pageIndex:j.currentPage-1,pageSize:j.pageSize,totalItemCount:ae,pageSizeOptions:S},isSelectable:!0,selection:s?{onSelectionChange:e=>{M(e),k("manual")},selectable:de,selectableMessage:(e,t)=>e?"":t.active?t.policy_id&&ue[t.policy_id].is_managed?"This action is not available for agents enrolled in an externally managed agent policy":"":"This agent is not active"}:void 0,onChange:({page:e})=>{const t={...j,currentPage:e.index+1,pageSize:e.size};F(t)}}))};var ve=a(122);const ke=l.a.createContext({refresh:()=>{}});var xe=a(39);const Me="logs-elastic_agent-*,logs-elastic_agent.*-*",Oe="elastic_agent",je="elastic_agent.id",Se={name:"data_stream.dataset",type:"string",aggregatable:!0},Fe={name:"log.level",type:"string",aggregatable:!0},Ie="now-1d",Te="now",Pe={start:Ie,end:Te,logLevels:[],datasets:[Oe],query:""},we={ERROR:"error",WARNING:"warning",INFO:"info",DEBUG:"debug"},Ce=["error","warning","warn","notice","info","debug"],Ae=we.INFO;var Le=a(279),_e=a.n(Le),De=a(141),Ne=a(78),Be=a(286),Re=a.n(Be),ze=a(142),Ue=a(285),qe=a.n(Ue),He=a(34),Ge=a.n(He),Ve=a(79);const $e=Object(n.memo)((({selectedDatasets:e,onToggleDataset:t})=>{const{data:a}=Object(o.jb)(),[i,s]=Object(n.useState)(!1),[r,u]=Object(n.useState)(!1),[g,m]=Object(n.useState)([Oe]),p=Object(n.useCallback)((()=>s((e=>!e))),[s]),f=Object(n.useCallback)((()=>s(!1)),[s]);return Object(n.useEffect)((()=>{(async()=>{u(!0);try{const e=await a.autocomplete.getValueSuggestions({indexPattern:{title:Me,fields:[Se]},field:Se,query:""});e.length>0&&m(e.sort())}catch(e){m([Oe])}u(!1)})()}),[a.autocomplete]),l.a.createElement(c.EuiPopover,{button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:p,isSelected:i,isLoading:r,numFilters:g.length,hasActiveFilters:e.length>0,numActiveFilters:e.length},d.i18n.translate("xpack.fleet.agentLogs.datasetSelectText",{defaultMessage:"Dataset"})),isOpen:i,closePopover:f,panelPaddingSize:"none"},g.map((a=>l.a.createElement(c.EuiFilterSelectItem,{checked:e.includes(a)?"on":void 0,key:a,onClick:()=>t(a)},a))))}));const We=Object(n.memo)((({selectedLevels:e,onToggleLevel:t})=>{const{data:a}=Object(o.jb)(),[i,s]=Object(n.useState)(!1),[r,u]=Object(n.useState)(!1),[g,m]=Object(n.useState)([]),p=Object(n.useCallback)((()=>s((e=>!e))),[]),f=Object(n.useCallback)((()=>s(!1)),[]);Object(n.useEffect)((()=>{(async()=>{u(!0);try{const t=await a.autocomplete.getValueSuggestions({indexPattern:{title:Me,fields:[Fe]},field:Fe,query:""});m((e=t,[...new Set([...Ce.filter((t=>e.includes(t))),...e.sort()])]))}catch(e){m([])}var e;u(!1)})()}),[a.autocomplete]);const E=l.a.createElement("div",{className:"euiFilterSelect__note"},l.a.createElement("div",{className:"euiFilterSelect__noteContent"},l.a.createElement(c.EuiIcon,{type:"minusInCircle"}),l.a.createElement(c.EuiSpacer,{size:"xs"}),l.a.createElement("p",null,d.i18n.translate("xpack.fleet.agentLogs.logLevelEmpty",{defaultMessage:"No Logs Found"})))),h=g.map((a=>l.a.createElement(c.EuiFilterSelectItem,{checked:e.includes(a)?"on":void 0,key:a,onClick:()=>t(a)},a)));return l.a.createElement(c.EuiPopover,{button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:p,isSelected:i,isLoading:r,numFilters:g.length,hasActiveFilters:e.length>0,numActiveFilters:e.length},d.i18n.translate("xpack.fleet.agentLogs.logLevelSelectText",{defaultMessage:"Log level"})),isOpen:i,closePopover:f,panelPaddingSize:"none"},0===g.length?E:h)}));var Ke=a(72);const Qe=[je,Se.name,Fe.name],Ye=Object(n.memo)((({query:e,isQueryValid:t,onUpdateQuery:a})=>{const{data:i}=Object(o.jb)(),[s,r]=Object(n.useState)();return Object(n.useEffect)((()=>{(async()=>{try{const e=(await i.indexPatterns.getFieldsForWildcard({pattern:Me})||[]).filter((e=>!Qe.includes(e.name)));r(e)}catch(e){r(void 0)}})()}),[i.indexPatterns]),l.a.createElement(Ke.QueryStringInput,{iconType:"search",disableLanguageSwitcher:!0,indexPatterns:s?[{title:Me,fields:s}]:[],query:{query:e,language:"kuery"},isInvalid:!t,disableAutoFocus:!0,placeholder:d.i18n.translate("xpack.fleet.agentLogs.searchPlaceholderText",{defaultMessage:"Search logs…"}),onChange:e=>{a(e.query)},onSubmit:e=>{a(e.query,!0)}})})),Ze=Object.values(we),Je=Object(n.memo)((({agent:e})=>{var t,a,i,s;const{notifications:r}=Object(o.jb)(),[g,m]=Object(n.useState)(!1),[p,f]=Object(n.useState)(null!==(t=null===(a=e.local_metadata)||void 0===a||null===(i=a.elastic)||void 0===i||null===(s=i.agent)||void 0===s?void 0:s.log_level)&&void 0!==t?t:Ae),[E,h]=Object(n.useState)(p),b=Object(n.useCallback)((()=>{m(!0),async function(){try{const t=await Object(o.x)(e.id,{action:{type:"SETTINGS",data:{log_level:E}}});if(t.error)throw t.error;f(E),r.toasts.addSuccess(d.i18n.translate("xpack.fleet.agentLogs.selectLogLevel.successText",{defaultMessage:"Changed agent logging level to '{logLevel}'.",values:{logLevel:E}}))}catch(e){r.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.agentLogs.selectLogLevel.errorTitleText",{defaultMessage:"Error updating agent logging level"})})}m(!1)}()}),[r,E,e.id]);return l.a.createElement(c.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFormLabel,{htmlFor:"selectAgentLogLevel"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.selectLogLevelLabelText",defaultMessage:"Agent logging level"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiSelect,{disabled:g,compressed:!0,id:"selectAgentLogLevel",value:E,onChange:e=>{h(e.target.value)},options:Ze.map((e=>({text:e,value:e})))})),p!==E&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{flush:"left",size:"xs",isLoading:g,disabled:p===E,iconType:"refresh",onClick:b},g?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.updateButtonLoadingText",defaultMessage:"Applying changes..."}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.updateButtonText",defaultMessage:"Apply changes"}))))})),Xe=m()(c.EuiFlexGroup).withConfig({displayName:"WrapperFlexGroup",componentId:"sc-mjo9ba-0"})(["height:100%;"]),et=m()(c.EuiFlexItem).withConfig({displayName:"DatePickerFlexItem",componentId:"sc-mjo9ba-1"})(["max-width:312px;"]),tt=Object(xe.createStateContainerReactHelpers)(),at=({agentPolicy:e})=>{const{getHref:t}=Object(o.db)();return l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiCallOut,{size:"m",color:"primary",iconType:"iInCircle",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.logDisabledCallOutTitle",defaultMessage:"Log collection is disabled"})},e.is_managed?null:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.logDisabledCallOutDescription",defaultMessage:"Update the agent's policy {settingsLink} to enable logs collection.",values:{settingsLink:l.a.createElement(c.EuiLink,{href:t("policy_details",{policyId:e.id,tabId:"settings"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.settingsLink",defaultMessage:"settings"}))}})))},nt=Object(n.memo)((({agent:e,agentPolicy:t,state:a})=>{var i,s,r,d;const{data:g,application:m,http:p}=Object(o.jb)(),{update:f}=tt.useTransitions(),h=Object(n.useCallback)((e=>{const{min:t,max:a}=g.query.timefilter.timefilter.calculateBounds(e);return t&&a?{start:t.valueOf(),end:a.valueOf()}:void 0}),[g.query.timefilter.timefilter]),b=Object(n.useCallback)((e=>{h(e)&&f({start:e.from,end:e.to})}),[h,f]),[y,v]=Object(n.useState)(h({from:a.start,to:a.end})||h({from:Ie,to:Te}));Object(n.useEffect)((()=>{const e=h({from:a.start,to:a.end});e?v(e):b({from:Ie,to:Te})}),[a.start,a.end,h,b]);const k=Object(n.useCallback)((e=>{try{return Object(ze.a)(e),!0}catch(e){return!1}}),[]),[x,M]=Object(n.useState)(a.query),[O,j]=Object(n.useState)(k(a.query)),S=Object(n.useCallback)(((e,t)=>{M(e),k(e)?(j(!0),t&&f({query:e})):j(!1)}),[k,f]),F=Object(n.useMemo)((()=>(({agentId:e,datasets:t,logLevels:a,userQuery:n})=>{const l=`${je}:${e}`,i=t.length?t.map((e=>`${Se.name}:${e}`)).join(" or "):`${Se.name}:elastic_agent or ${Se.name}:elastic_agent.*`,s=a.map((e=>`${Fe.name}:${e}`)).join(" or "),r=`${l} and (${i})`,o=s?`${r} and (${s})`:r;return n?`(${o}) and (${n})`:o})({agentId:e.id,datasets:a.datasets,logLevels:a.logLevels,userQuery:a.query})),[e.id,a.datasets,a.logLevels,a.query]),I=Object(n.useMemo)((()=>p.basePath.prepend(_e.a.format({pathname:"/app/logs/stream",search:Object(De.stringify)({logPosition:Object(Ne.encode)({start:a.start,end:a.end,streamLive:!1}),logFilter:Object(Ne.encode)({expression:F,kind:"kuery"})})}))),[p.basePath,a.start,a.end,F]),T=null===(i=e.local_metadata)||void 0===i||null===(s=i.elastic)||void 0===s||null===(r=s.agent)||void 0===r?void 0:r.version,P=Object(n.useMemo)((()=>{var e;if(!T)return!1;const t=null===(e=Ge()(T))||void 0===e?void 0:e.version;return!!t&&qe()(t,"7.11.0")}),[T]),[w,{height:C}]=Re()(),A=Object(n.useMemo)((()=>Math.max(C,600)),[C]);return P?l.a.createElement(Xe,{direction:"column",gutterSize:"m"},t&&!(null!==(d=t.monitoring_enabled)&&void 0!==d&&d.includes("logs"))&&l.a.createElement(at,{agentPolicy:t}),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexGroup,{gutterSize:"m"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(Ye,{query:x,onUpdateQuery:S,isQueryValid:O})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFilterGroup,null,l.a.createElement($e,{selectedDatasets:a.datasets,onToggleDataset:e=>{const t=[...a.datasets],n=t.indexOf(e);n>=0?(t.splice(n,1),f({datasets:t})):f({datasets:[...a.datasets,e]})}}),l.a.createElement(We,{selectedLevels:a.logLevels,onToggleLevel:e=>{const t=[...a.logLevels],n=t.indexOf(e);n>=0?(t.splice(n,1),f({logLevels:t})):f({logLevels:[...a.logLevels,e]})}}))),l.a.createElement(et,{grow:!1},l.a.createElement(c.EuiSuperDatePicker,{showUpdateButton:!1,start:a.start,end:a.end,onTimeChange:({start:e,end:t})=>{b({from:e,to:t})}})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(E.RedirectAppLinks,{application:m},l.a.createElement(c.EuiButtonEmpty,{href:I,iconType:"popout",flush:"both"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.openInLogsUiLinkText",defaultMessage:"Open in Logs"})))))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiPanel,{paddingSize:"none",panelRef:w},l.a.createElement(Ve.LogStream,{height:A,startTimestamp:y.start,endTimestamp:y.end,query:F}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(Je,{agent:e}))):l.a.createElement(c.EuiCallOut,{size:"m",color:"warning",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.oldAgentWarningTitle",defaultMessage:"The Logs view requires Elastic Agent 7.11 or higher. To upgrade an agent, go to the Actions menu, or {downloadLink} a newer version.",values:{downloadLink:l.a.createElement(c.EuiLink,{href:"https://ela.st/download-elastic-agent",external:!0,target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.downloadLink",defaultMessage:"download"}))}})})})),lt=Object(n.memo)((({agent:e,agentPolicy:t})=>{const a=Object(n.useMemo)((()=>Object(xe.createStateContainer)({...Pe,...Object(xe.getStateFromKbnUrl)("_q",window.location.href,{getFromHashQuery:!1})},{update:e=>t=>({...e,...t})})),[]),i=Object(n.useMemo)((()=>tt.connect((e=>({state:e||Pe})))(nt)),[]),[s,r]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{const e=Object(xe.createKbnUrlStateStorage)({useHashQuery:!1,useHash:!1}),{start:t,stop:n}=Object(xe.syncState)({storageKey:"_q",stateContainer:a,stateStorage:e});return t(),r(!0),()=>{n(),a.set(Pe)}}),[a]),l.a.createElement(tt.Provider,{value:a},s?l.a.createElement(i,{agent:e,agentPolicy:t}):null)})),it=Object(n.memo)((({agent:e,assignFlyoutOpenByDefault:t=!1,onCancelReassign:a,agentPolicy:i})=>{const s=Object(o.M)().write,r=Object(o.bb)(),d=l.a.useContext(ke).refresh,[g,m]=Object(n.useState)(t),[p,f]=Object(n.useState)(!1),[E,h]=Object(n.useState)(!1),b="unenrolling"===e.status,k=i&&i.package_policies.some((e=>{var t;return"string"!=typeof e&&(null===(t=e.package)||void 0===t?void 0:t.name)===v.g})),x=Object(n.useMemo)((()=>a||(()=>m(!1))),[a,m]);return l.a.createElement(l.a.Fragment,null,g&&l.a.createElement(c.EuiPortal,null,l.a.createElement(Y,{agents:[e],onClose:x})),p&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ee,{agents:[e],agentCount:1,onClose:()=>{f(!1),d()},useForceUnenroll:b,hasFleetServer:k})),E&&l.a.createElement(c.EuiPortal,null,l.a.createElement(te,{agents:[e],agentCount:1,version:r,onClose:()=>{h(!1),d()}})),l.a.createElement(y.e,{button:{props:{iconType:"arrowDown",iconSide:"right",color:"primary"},children:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.actionsButton",defaultMessage:"Actions"})},items:[l.a.createElement(c.EuiContextMenuItem,{icon:"pencil",onClick:()=>{m(!0)},disabled:!e.active,key:"reassignPolicy"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.reassignActionText",defaultMessage:"Assign to new policy"})),l.a.createElement(c.EuiContextMenuItem,{icon:"cross",disabled:!s||!e.active,onClick:()=>{f(!0)}},b?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.forceUnenrollOneButton",defaultMessage:"Force unenroll"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.unenrollOneButton",defaultMessage:"Unenroll agent"})),l.a.createElement(c.EuiContextMenuItem,{icon:"refresh",disabled:!Object(T.i)(e,r),onClick:()=>{h(!0)}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.upgradeOneButton",defaultMessage:"Upgrade agent"}))]}))})),st=m()(c.EuiFlexItem).withConfig({displayName:"FlexItemWithMinWidth",componentId:"sc-19wc892-0"})(["min-width:0px;"]),rt=Object(n.memo)((({agent:e,agentPolicy:t})=>{var a,n,i,s,r,g,m,p,f,E,h,b,v,k,x;const M=Object(o.bb)();return l.a.createElement(c.EuiPanel,null,l.a.createElement(c.EuiDescriptionList,{compressed:!0},[{title:d.i18n.translate("xpack.fleet.agentDetails.hostIdLabel",{defaultMessage:"Agent ID"}),description:e.id},{title:d.i18n.translate("xpack.fleet.agentDetails.agentPolicyLabel",{defaultMessage:"Agent policy"}),description:t?l.a.createElement(y.d,{policy:t}):e.policy_id||"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.versionLabel",{defaultMessage:"Agent version"}),description:"string"==typeof(null===(a=e.local_metadata)||void 0===a||null===(n=a.elastic)||void 0===n||null===(i=n.agent)||void 0===i?void 0:i.version)?l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center",style:{minWidth:0}},l.a.createElement(c.EuiFlexItem,{grow:!1,className:"eui-textNoWrap"},e.local_metadata.elastic.agent.version),Object(T.i)(e,M)?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiToolTip,{position:"right",content:d.i18n.translate("xpack.fleet.agentList.agentUpgradeLabel",{defaultMessage:"Upgrade available"})},l.a.createElement(c.EuiIcon,{type:"alert",color:"warning"}))):null):"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.integrationsLabel",{defaultMessage:"Integrations"}),description:e.policy_id?l.a.createElement(y.c,{agentPolicyId:e.policy_id,hideTitle:!0}):null},{title:d.i18n.translate("xpack.fleet.agentDetails.hostNameLabel",{defaultMessage:"Host name"}),description:"string"==typeof(null===(s=e.local_metadata)||void 0===s||null===(r=s.host)||void 0===r?void 0:r.hostname)?e.local_metadata.host.hostname:"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.logLevel",{defaultMessage:"Logging level"}),description:"string"==typeof(null===(g=e.local_metadata)||void 0===g||null===(m=g.elastic)||void 0===m||null===(p=m.agent)||void 0===p?void 0:p.log_level)?e.local_metadata.elastic.agent.log_level:"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.releaseLabel",{defaultMessage:"Agent release"}),description:"boolean"==typeof(null===(f=e.local_metadata)||void 0===f||null===(E=f.elastic)||void 0===E||null===(h=E.agent)||void 0===h?void 0:h.snapshot)?!0===e.local_metadata.elastic.agent.snapshot?"snapshot":"stable":"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.platformLabel",{defaultMessage:"Platform"}),description:"string"==typeof(null===(b=e.local_metadata)||void 0===b||null===(v=b.os)||void 0===v?void 0:v.platform)?e.local_metadata.os.platform:"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.monitorLogsLabel",{defaultMessage:"Monitor logs"}),description:Array.isArray(null==t?void 0:t.monitoring_enabled)?null!=t&&null!==(k=t.monitoring_enabled)&&void 0!==k&&k.includes("logs")?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorLogsEnabledText",defaultMessage:"True"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorLogsDisabledText",defaultMessage:"False"}):null},{title:d.i18n.translate("xpack.fleet.agentDetails.monitorMetricsLabel",{defaultMessage:"Monitor metrics"}),description:Array.isArray(null==t?void 0:t.monitoring_enabled)?null!=t&&null!==(x=t.monitoring_enabled)&&void 0!==x&&x.includes("metrics")?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorMetricsEnabledText",defaultMessage:"True"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorMetricsDisabledText",defaultMessage:"False"}):null}].map((({title:e,description:t})=>l.a.createElement(c.EuiFlexGroup,null,l.a.createElement(st,{grow:3},l.a.createElement(c.EuiDescriptionListTitle,null,e)),l.a.createElement(st,{grow:7},l.a.createElement(c.EuiDescriptionListDescription,{className:"eui-textTruncate"},t)))))))}));function ot(e){return"logfile"===e?"(datasets:!(elastic_agent.filebeat))":e.match(/\/metrics$/)?"(datasets:!(elastic_agent.metricbeat))":"osquery"===e?"(datasets:!(elastic_agent.osquerybeat))":e.match(/^synthetics\//)?"(datasets:!(elastic_agent.heartbeat))":"apm"===e?"(datasets:!(elastic_agent.apm_server))":"endpoint"===e?"(datasets:!(elastic_agent.endpoint_security))":""}const ct=m()(c.EuiAccordion).withConfig({displayName:"StyledEuiAccordion",componentId:"sc-12a1xr8-0"})([".ingest-integration-title-button{padding:",";}&.euiAccordion-isOpen .ingest-integration-title-button{border-bottom:1px solid ",";}.euiTableRow:last-child .euiTableRowCell{border-bottom:none;}.euiIEFlexWrapFix{min-width:0;}"],(e=>e.theme.eui.paddingSizes.m),(e=>e.theme.eui.euiColorLightShade)),ut=({id:e,title:t,children:a})=>l.a.createElement(c.EuiPanel,{paddingSize:"none"},l.a.createElement(ct,{id:e,arrowDisplay:"right",buttonClassName:"ingest-integration-title-button",buttonContent:t},a)),dt=Object(n.memo)((({agent:e,agentPolicy:t,packagePolicy:a})=>{const{getHref:i}=Object(o.db)(),s=Object(n.useMemo)((()=>a.inputs.filter((e=>e.enabled))),[a.inputs]),r=[{field:"type",width:"100%",name:d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeLabel",{defaultMessage:"Input"}),render:e=>function(e){return"logfile"===e?d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeLogText",{defaultMessage:"Logs"}):"endpoint"===e?d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeEndpointText",{defaultMessage:"Endpoint"}):e.match(/\/metrics$/)?d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeMetricsText",{defaultMessage:"Metrics"}):e}(e)},{align:"right",name:d.i18n.translate("xpack.fleet.agentDetailsIntegrations.actionsLabel",{defaultMessage:"Actions"}),field:"type",width:"auto",render:t=>l.a.createElement(c.EuiToolTip,{content:d.i18n.translate("xpack.fleet.agentDetailsIntegrations.viewLogsButton",{defaultMessage:"View logs"})},l.a.createElement(c.EuiButtonIcon,{href:i("agent_details",{agentId:e.id,tabId:"logs",logQuery:ot(t)}),iconType:"editorAlignLeft","aria-label":d.i18n.translate("xpack.fleet.agentDetailsIntegrations.viewLogsButton",{defaultMessage:"View logs"})}))}];return l.a.createElement(ut,{id:a.id,title:l.a.createElement(c.EuiTitle,{size:"xs"},l.a.createElement("h3",null,l.a.createElement(c.EuiFlexGroup,{gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:!1},a.package?l.a.createElement(y.m,{packageName:a.package.name,version:a.package.version,size:"l",tryApi:!0}):l.a.createElement(y.m,{size:"l",packageName:"default",version:"0"})),l.a.createElement(c.EuiFlexItem,{className:"eui-textTruncate"},l.a.createElement(c.EuiLink,{className:"eui-textTruncate",href:i("edit_integration",{policyId:t.id,packagePolicyId:a.id})},a.name)))))},l.a.createElement(c.EuiBasicTable,{tableLayout:"auto",items:s,columns:r}))})),gt=Object(n.memo)((({agent:e,agentPolicy:t})=>t&&t.package_policies?l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"m"},t.package_policies.map((a=>l.a.createElement(c.EuiFlexItem,{grow:!1,key:a.id},l.a.createElement(dt,{agent:e,agentPolicy:t,packagePolicy:a}))))):null)),mt=m()(c.EuiFlexItem).withConfig({displayName:"FlexItemWithMinWidth",componentId:"sc-1svqtoc-0"})(["min-width:0px;"]),pt=Object(n.memo)((({agent:e,agentPolicy:t})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{alignItems:"flexStart"},l.a.createElement(mt,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.overviewSectionTitle",defaultMessage:"Overview"}))),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(rt,{agent:e,agentPolicy:t})),l.a.createElement(mt,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.integrationsSectionTitle",defaultMessage:"Integrations"}))),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(gt,{agent:e,agentPolicy:t})))))),ft=()=>{var e,t,a;const{params:{agentId:i,tabId:s=""}}=Object(r.useRouteMatch)(),{getHref:g}=Object(o.db)(),m=Object(o.bb)(),{isLoading:p,isInitialRequest:f,error:E,data:h,resendRequest:b}=Object(o.T)(i,{pollIntervalMs:5e3}),{isLoading:v,data:x,sendRequest:M}=Object(o.U)(null==h||null===(e=h.item)||void 0===e?void 0:e.policy_id),{application:{navigateToApp:O}}=Object(o.jb)(),j=Object(o.Z)(),S="true"===new URLSearchParams(Object(r.useLocation)().search).get("openReassignFlyout"),F=Object(n.useCallback)((()=>{j&&j.onDoneNavigateTo&&O(j.onDoneNavigateTo[0],j.onDoneNavigateTo[1])}),[j,O]),I=null==h||null===(t=h.item)||void 0===t||null===(a=t.local_metadata)||void 0===a?void 0:a.host,P=Object(n.useMemo)((()=>l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"s",alignItems:"flexStart"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiButtonEmpty,{iconType:"arrowLeft",href:g("agent_list"),flush:"left",size:"xs"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.viewAgentListTitle",defaultMessage:"View all agents"}))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{className:"eui-textBreakWord"},l.a.createElement("h1",null,p&&f?l.a.createElement(y.k,null):"object"==typeof I&&"string"==typeof(null==I?void 0:I.hostname)?I.hostname:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.agentDetailsTitle",defaultMessage:"Agent '{id}'",values:{id:i}})))))),[I,i,g,f,p]),w=Object(n.useMemo)((()=>{var e;return h&&h.item?l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",direction:"row"},[{label:d.i18n.translate("xpack.fleet.agentDetails.statusLabel",{defaultMessage:"Status"}),content:l.a.createElement(X,{agent:h.item})},{label:d.i18n.translate("xpack.fleet.agentDetails.lastActivityLabel",{defaultMessage:"Last activity"}),content:h.item.last_checkin?l.a.createElement(u.FormattedRelative,{value:new Date(h.item.last_checkin)}):"-"},{label:d.i18n.translate("xpack.fleet.agentDetails.policyLabel",{defaultMessage:"Policy"}),content:v?l.a.createElement(y.k,{size:"m"}):null!=x&&x.item?l.a.createElement(c.EuiLink,{href:g("policy_details",{policyId:h.item.policy_id}),className:"eui-textBreakWord"},x.item.name||h.item.policy_id):h.item.policy_id||"-"},{label:d.i18n.translate("xpack.fleet.agentDetails.agentVersionLabel",{defaultMessage:"Agent version"}),content:"object"==typeof h.item.local_metadata.elastic&&"object"==typeof h.item.local_metadata.elastic.agent&&"string"==typeof h.item.local_metadata.elastic.agent.version?l.a.createElement(c.EuiFlexGroup,{gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:!1,className:"eui-textNoWrap"},h.item.local_metadata.elastic.agent.version),Object(T.i)(h.item,m)?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiIconTip,{"aria-label":d.i18n.translate("xpack.fleet.agentDetails.upgradeAvailableTooltip",{defaultMessage:"Upgrade available"}),size:"m",type:"alert",color:"warning",content:d.i18n.translate("xpack.fleet.agentDetails.upgradeAvailableTooltip",{defaultMessage:"Upgrade available"})})):null):"-"},{content:v||null!=x&&null!==(e=x.item)&&void 0!==e&&e.is_managed?void 0:l.a.createElement(it,{agent:h.item,agentPolicy:null==x?void 0:x.item,assignFlyoutOpenByDefault:S,onCancelReassign:j&&j.onDoneNavigateTo?F:void 0})}].map(((e,t)=>l.a.createElement(c.EuiFlexItem,{grow:!1,key:t},e.label?l.a.createElement(c.EuiDescriptionList,{compressed:!0},l.a.createElement(c.EuiDescriptionListTitle,null,e.label),l.a.createElement(c.EuiDescriptionListDescription,null,e.content)):e.content)))):void 0}),[x,h,g,v]),C=Object(n.useMemo)((()=>[{id:"details",name:d.i18n.translate("xpack.fleet.agentDetails.subTabs.detailsTab",{defaultMessage:"Agent details"}),href:g("agent_details",{agentId:i,tabId:"details"}),isSelected:!s||"details"===s},{id:"logs",name:d.i18n.translate("xpack.fleet.agentDetails.subTabs.logsTab",{defaultMessage:"Logs"}),href:g("agent_details_logs",{agentId:i,tabId:"logs"}),isSelected:"logs"===s}]),[g,i,s]);return l.a.createElement(ke.Provider,{value:{refresh:()=>{b(),M()}}},l.a.createElement(k.c,{leftColumn:P,rightColumn:w,tabs:C},p&&f?l.a.createElement(y.k,null):E?l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.unexceptedErrorTitle",defaultMessage:"Error loading agent"}),error:E}):h&&h.item?l.a.createElement(Et,{agent:h.item,agentPolicy:null==x?void 0:x.item}):l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.agentNotFoundErrorTitle",defaultMessage:"Agent not found"}),error:d.i18n.translate("xpack.fleet.agentDetails.agentNotFoundErrorDescription",{defaultMessage:"Cannot find agent ID {agentId}",values:{agentId:i}})})))},Et=({agent:e,agentPolicy:t})=>(Object(o.L)("agent_details",{agentHost:"object"==typeof e.local_metadata.host&&"string"==typeof e.local_metadata.host.hostname?e.local_metadata.host.hostname:"-"}),l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:v.f.agent_details_logs,render:()=>l.a.createElement(lt,{agent:e,agentPolicy:t})}),l.a.createElement(r.Route,{path:v.f.agent_details,render:()=>l.a.createElement(pt,{agent:e,agentPolicy:t})}))),ht=Object(r.withRouter)((({actionSection:e,title:t,modalClosePath:a,children:n})=>l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceAround"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiPageContent,null,l.a.createElement(c.EuiEmptyPrompt,{iconType:"logoBeats",title:l.a.createElement("h2",null,t),body:n,actions:e})))))),bt=Object(u.injectI18n)((({intl:e})=>l.a.createElement(ht,{title:e.formatMessage({id:"xpack.fleet.noAccess.accessDeniedTitle",defaultMessage:"Access denied"}),actionSection:[]},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.noAccess.accessDeniedDescription",defaultMessage:"You are not authorized to access Elastic Fleet. To use Elastic Fleet, you need a user role that contains read or all permissions for this application."}))))),yt=({onClose:e})=>{const{getAssetsPath:t}=Object(o.db)(),{notifications:a,cloud:i,docLinks:s}=Object(o.jb)(),r=!(null==i||!i.cloudId),[g,m]=Object(n.useState)(!1),[p,f]=Object(n.useState)(!1);Object(n.useEffect)((()=>{!async function(){try{const a={},s=await Object(o.p)({page:1,perPage:10,showInactive:!1});if(s.error)throw s.error;for(const r of null!==(t=null===(n=s.data)||void 0===n?void 0:n.list)&&void 0!==t?t:[]){var t,n,l,i;if(!r.policy_id||a[r.policy_id])continue;a[r.policy_id]=!0;const s=await Object(o.s)(r.policy_id);if(!(null!==(l=(null===(i=s.data)||void 0===i?void 0:i.item.package_policies).some((e=>{var t;return(null===(t=e.package)||void 0===t?void 0:t.name)===v.g})))&&void 0!==l&&l))return await Object(o.E)({has_seen_fleet_migration_notice:!0}),void e()}f(!0)}catch(e){a.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.fleetServerUpgradeModal.errorLoadingAgents",{defaultMessage:"Error loading agents"})})}}()}),[a.toasts,e]);const E=Object(n.useCallback)((async()=>{try{m(!g),await Object(o.E)({has_seen_fleet_migration_notice:!g})}catch(e){a.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.fleetServerUpgradeModal.failedUpdateTitle",{defaultMessage:"Error saving settings"})})}}),[g,m,a]);return p?l.a.createElement(c.EuiModal,{onClose:e},l.a.createElement(c.EuiModalHeader,null,l.a.createElement(c.EuiModalHeaderTitle,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.modalTitle",defaultMessage:"Enroll your agents into Fleet Server"}))),l.a.createElement(c.EuiModalBody,null,l.a.createElement(c.EuiImage,{size:"fullWidth",src:t("./announcement.jpg"),alt:d.i18n.translate("xpack.fleet.fleetServerUpgradeModal.announcementImageAlt",{defaultMessage:"Fleet Server upgrade announcement"})}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiText,null,r?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.cloudDescriptionMessage",defaultMessage:"Fleet Server is now available and it provides improved scalability and security. If you already had an APM instance on Elastic Cloud, we've upgraded it to APM & Fleet. If not, you can add one to your deployment for free. {existingAgentsMessage} To continue using Fleet, you must use Fleet Server and install the new version of Elastic Agent on each host.",values:{existingAgentsMessage:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.existingAgentText",defaultMessage:"Your existing Elastic Agents have been automatically unenrolled and have stopped sending data."}))}}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.onPremDescriptionMessage",defaultMessage:"Fleet Server is now available and it provides improved scalability and security. {existingAgentsMessage} To continue using Fleet, you must install a Fleet Server and the new version of Elastic Agent on each host. Learn more in our {link}.",values:{existingAgentsMessage:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.existingAgentText",defaultMessage:"Your existing Elastic Agents have been automatically unenrolled and have stopped sending data."})),link:l.a.createElement(c.EuiLink,{href:s.links.fleet.upgradeElasticAgent712lower,external:!0,target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.fleetServerMigrationGuide",defaultMessage:"Fleet Server migration guide"}))}})),l.a.createElement(c.EuiSpacer,{size:"l"}),l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.breakingChangeMessage",defaultMessage:"This is a breaking change, which is why we are making it in a beta release. We are sorry for the inconvenience. Please share {link} if you have questions or need help.",values:{link:l.a.createElement(c.EuiLink,{href:"https://ela.st/fleet-feedback",target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.fleetFeedbackLink",defaultMessage:"feedback"}))}}))),l.a.createElement(c.EuiModalFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiCheckbox,{id:"fleetServerModalCheckbox",label:d.i18n.translate("xpack.fleet.fleetServerUpgradeModal.checkboxLabel",{defaultMessage:"Do not show this message again"}),checked:g,onChange:E})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,onClick:e},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.closeButton",defaultMessage:"Close and get started"})))))):null},vt=()=>{var e;Object(o.L)("agent_list");const t=Object(r.useHistory)(),{agents:a}=Object(o.N)(),i=Object(o.M)(),s=Object(o.Q)({page:1,perPage:1e3}),d=Object(n.useMemo)((()=>{var e;return(null===(e=s.data)||void 0===e?void 0:e.items)||[]}),[s.data]),g=Object(o.P)(),m=Object(o.Y)(),[p,f]=Object(n.useState)(!1),[E,h]=Object(n.useState)(!1),b=Object(n.useCallback)((()=>{h(!1)}),[h]);if(Object(n.useEffect)((()=>{var e;m.data&&!1===(null===(e=m.data)||void 0===e?void 0:e.item.has_seen_fleet_migration_notice)&&h(!0)}),[m.data]),!a.enabled)return null;if(!g.missingRequirements&&g.isLoading)return l.a.createElement(y.k,null);if(g.error)return l.a.createElement(k.d,null,l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentsInitializationErrorMessageTitle",defaultMessage:"Unable to initialize central management for Elastic Agents"}),error:g.error}));const x=1===(null==g||null===(e=g.missingRequirements)||void 0===e?void 0:e.length)&&"fleet_server"===g.missingRequirements[0];if(!x&&g.missingRequirements&&g.missingRequirements.length>0)return l.a.createElement(ve.b,{missingRequirements:g.missingRequirements});if(!i.read)return l.a.createElement(bt,null);const M=x?l.a.createElement(l.a.Fragment,null,p&&l.a.createElement(c.EuiPortal,null,l.a.createElement(y.b,{defaultMode:"standalone",agentPolicies:d,onClose:()=>f(!1)})),l.a.createElement(c.EuiFlexGroup,{justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>f(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addAgentButton",defaultMessage:"Add Agent"}))))):void 0;return l.a.createElement(r.Router,{history:t},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:v.f.agent_details},l.a.createElement(ft,null)),l.a.createElement(r.Route,{path:v.f.agents},l.a.createElement(k.a,{section:"agents",rightColumn:M},E&&l.a.createElement(yt,{onClose:b}),x?l.a.createElement(ve.a,null):l.a.createElement(ye,null)))))};var kt=a(93),xt=a(2),Mt=a(108),Ot=a(98),jt=a(12);const St=m()(c.EuiFormRow).withConfig({displayName:"AgentPolicyFormRow",componentId:"sc-1qoukpq-0"})([".euiFormRow__label{width:100%;}"]),Ft=({packageInfo:e,agentPolicy:t,updateAgentPolicy:a,defaultAgentPolicyId:i,setHasAgentPolicyError:s,onNewAgentPolicyCreate:r})=>{var g,m,p;const{isReady:f}=Object(o.P)(),[E,h]=Object(n.useState)(null!==(g=null==t?void 0:t.id)&&void 0!==g?g:i),[b,v]=Object(n.useState)(),k=Object(o.M)().write,[x,M]=Object(n.useState)(!1),{data:O,error:j,isLoading:S,resendRequest:I}=Object(o.Q)({page:1,perPage:1e3,sortField:"name",sortOrder:"asc",full:!0}),P=Object(n.useMemo)((()=>(null==O?void 0:O.items.filter((e=>!e.is_managed)))||[]),[null==O?void 0:O.items]),w=Object(n.useMemo)((()=>P.reduce(((e,t)=>(e[t.id]=t,e)),{})),[P]),C=Object(n.useCallback)(((e,t)=>!!e&&(Object(T.j)(t)&&Object(T.e)(e,t.name))),[]);Object(n.useEffect)((()=>{t&&E===t.id||(async()=>{if(E){const{data:e,error:t}=await Object(o.s)(E);t?(v(t),a(void 0)):e&&e.item&&(v(void 0),a(e.item))}else v(void 0),a(void 0)})()}),[E,t,a]);const A=Object(n.useMemo)((()=>e?P.map((t=>({label:t.name,value:t.id,disabled:C(t,e),"data-test-subj":"agentPolicyItem"}))):[]),[P,C,e]),L=Object(n.useMemo)((()=>A.find((e=>e.value===E))),[A,E]);return Object(n.useEffect)((()=>{if(!E&&P.length&&A.length){const e=A.find((e=>!e.disabled)),t=P.find((e=>e.is_default));if(t){const a=A.find((e=>e.value===t.id));a&&!a.disabled?h(t.id):e&&h(e.value)}else e&&h(e.value)}}),[P,A,E]),Object(n.useEffect)((()=>{E&&!b&&L&&!L.disabled?s(!1):s(!0)}),[b,L,E,s]),j?l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.errorLoadingAgentPoliciesTitle",defaultMessage:"Error loading agent policies"}),error:j}):l.a.createElement(l.a.Fragment,null,x?l.a.createElement(c.EuiPortal,null,l.a.createElement(F,{onClose:e=>{M(!1),e&&(r(),I(),h(e.id))},ownFocus:!0})):null,l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"m"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiDescribedFormGroup,{title:l.a.createElement(c.EuiTitle,{size:"xs"},l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.agentPolicyFormGroupTitle",defaultMessage:"Agent policy"}))),description:l.a.createElement(c.EuiText,{color:"subdued",size:"s"},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.agentPolicyFormGroupDescription",defaultMessage:"Agent policies are used to manage a group of integrations across a set of agents"})))},l.a.createElement(St,{fullWidth:!0,label:l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.agentPolicyLabel",defaultMessage:"Agent policy"})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement("div",null,l.a.createElement(c.EuiLink,{disabled:!k,onClick:()=>M(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.addButton",defaultMessage:"Create agent policy"}))))),helpText:f&&E?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.agentPolicyAgentsDescriptionText",defaultMessage:"{count, plural, one {# agent is} other {# agents are}} enrolled with the selected agent policy.",values:{count:null!==(m=null===(p=w[E])||void 0===p?void 0:p.agents)&&void 0!==m?m:0}}):null,isInvalid:Boolean(!E||!e||C(w[E],e)),error:E?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.cannotAddLimitedIntegrationError",defaultMessage:"This integration can only be added once per agent policy."}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.noPolicySelectedError",defaultMessage:"An agent policy is required."})},l.a.createElement(c.EuiComboBox,{placeholder:d.i18n.translate("xpack.fleet.createPackagePolicy.StepSelectPolicy.agentPolicyPlaceholderText",{defaultMessage:"Select an agent policy to add this integration to"}),singleSelection:{asPlainText:!0},isClearable:!1,fullWidth:!0,isLoading:S||!e,options:A,selectedOptions:L?[L]:[],onChange:e=>{const t=e[0]||void 0;t?t.value!==E&&h(t.value):h(void 0)}})))),b?l.a.createElement(c.EuiFlexItem,null,l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.errorLoadingSelectedAgentPolicyTitle",defaultMessage:"Error loading selected agent policy"}),error:b})):null))};var It=a(137),Tt=a(138);const Pt=m()(c.EuiSteps).withConfig({displayName:"StepsWithLessPadding",componentId:"sc-1smjujo-0"})([".euiStep__content{padding-bottom:",";}@media (max-width:","){margin-bottom:100px;}"],(e=>e.theme.eui.paddingSizes.m),(e=>e.theme.eui.euiBreakpoints.m)),wt=m()(c.EuiBottomBar).withConfig({displayName:"CustomEuiBottomBar",componentId:"sc-1smjujo-1"})(["z-index:50;"]),Ct=()=>{var e,t;const{notifications:a}=Object(o.jb)(),{agents:{enabled:i}}=Object(o.N)(),{params:s}=Object(r.useRouteMatch)(),{getHref:g,getPath:m}=Object(o.db)(),p=Object(r.useHistory)(),f=Lt(),E=Object(o.Z)(),{search:h}=Object(r.useLocation)(),b=Object(n.useMemo)((()=>new URLSearchParams(h)),[h]),v=Object(n.useMemo)((()=>{var e;return null!==(e=b.get("policyId"))&&void 0!==e?e:void 0}),[b]),k="policyId"in s||v?"policy":"package",[M,j]=Object(n.useState)(),[S,F]=Object(n.useState)(),I=null==M?void 0:M.id;Object(n.useEffect)((()=>{i&&I&&(async()=>{const{data:e}=await Object(o.o)({policyId:I});void 0!==(null==e?void 0:e.results.total)&&w(e.results.total)})()}),[I,i]);const[P,w]=Object(n.useState)(0),[C,A]=Object(n.useState)({name:"",description:"",namespace:"",policy_id:"",enabled:!0,output_id:"",inputs:[]}),[L,_]=Object(n.useState)(!1),[D,N]=Object(n.useState)(),[B,R]=Object(n.useState)(!1),[z,U]=Object(n.useState)("VALID"),{data:q,error:H,isLoading:G}=Object(o.W)(s.pkgkey),V=Object(n.useMemo)((()=>{if(q&&q.response)return q.response}),[q]),$=Object(n.useCallback)((e=>{e?(j(e),V&&R(!1)):(R(!0),j(void 0)),console.debug("Agent policy updated",e)}),[V,j]),W=!!D&&Object(Ot.f)(D),K=Object(n.useCallback)((e=>{if(V){const t=Object(Ot.d)(e||C,V,kt.safeLoad);return N(t),console.debug("Package policy validation results",t),t}}),[C,V]),Q=Object(n.useCallback)((e=>{const t={...C,...e};A(t),console.debug("Package policy updated",t);const a=K(t),n=t.package,l=!!a&&Object(Ot.f)(a),i=t.policy_id&&""!==t.policy_id;U(n&&i&&!l?"VALID":"INVALID")}),[C,K]),Y=Object(n.useCallback)((({isValid:e,updatedPolicy:t})=>{Q(t),U((t=>"VALID"!==t||e?t:"INVALID"))}),[Q]),Z=Object(n.useMemo)((()=>E&&E.onCancelUrl?E.onCancelUrl:"policy"===k&&I?g("policy_details",{policyId:I}):g("integration_details_overview",{pkgkey:s.pkgkey})),[E,k,I,g,s.pkgkey]),J=Object(n.useCallback)((e=>{E&&E.onCancelNavigateTo&&(e.preventDefault(),f(E.onCancelNavigateTo))}),[E,f]),X=Object(n.useCallback)((async()=>{U("LOADING");const e=await Object(o.k)(C);return U(P?"SUBMITTED":"SUBMITTED_NO_AGENTS"),e}),[C,P]),ee=Object(n.useRef)(!0),te=Object(n.useCallback)((()=>{_(!0)}),[]);Object(n.useEffect)((()=>()=>{ee.current=!1}),[]);const ae=Object(n.useCallback)(((e,t=[])=>{if(!ee.current)return;const a=m("policy_details",{policyId:C.policy_id});if(null!=E&&E.onSaveNavigateTo&&e){const[n,l]=E.onSaveNavigateTo;if(null!=l&&l.path){const i=function({path:e,policy:t,paramsToApply:a,mappingOptions:n={}}){const[l,i]=e.split("?"),s=Object(jt.parse)(i);a.forEach((e=>{const a=n[e];if(a){const[n,l]=function(e,t,a){if(!t)return[];if("boolean"==typeof t&&t)return[e,"true"];return[t.renameKey?t.renameKey:e,t.policyIdAsValue?a:"true"]}(e,a,t.policy_id);n&&l&&(s[n]=l)}}));const r=Object(jt.stringify)(s);return l+(r?`?${r}`:"")}({path:L?a:l.path,policy:e,mappingOptions:E.onSaveQueryParams,paramsToApply:t});f([n,{...l,path:i}])}else f(E.onSaveNavigateTo)}else p.push(a)}),[C.policy_id,m,f,p,E,L]),ne=Object(n.useCallback)((async()=>{if("VALID"===z&&W)return void U("INVALID");if(0!==P&&"CONFIRM"!==z)return void U("CONFIRM");const{error:e,data:t}=await X();if(e)a.toasts.addError(e,{title:"Error"}),U("VALID");else{F(t.item);const e=P&&M;if(!e)return void U("SUBMITTED_NO_AGENTS");ae(t.item),a.toasts.addSuccess({title:d.i18n.translate("xpack.fleet.createPackagePolicy.addedNotificationTitle",{defaultMessage:"'{packagePolicyName}' integration added.",values:{packagePolicyName:C.name}}),text:e?d.i18n.translate("xpack.fleet.createPackagePolicy.addedNotificationMessage",{defaultMessage:"Fleet will deploy updates to all agents that use the '{agentPolicyName}' policy.",values:{agentPolicyName:M.name}}):void 0,"data-test-subj":"packagePolicyCreateSuccessToast"})}}),[z,W,P,X,ae,M,a.toasts,C.name]),le=Object(n.useMemo)((()=>{var e;return s.integration?null==V||null===(e=V.policy_templates)||void 0===e?void 0:e.find((e=>e.name===s.integration)):void 0}),[null==V?void 0:V.policy_templates,s]),ie=Object(n.useMemo)((()=>({from:k,cancelUrl:Z,onCancel:J,agentPolicy:M,packageInfo:V,integrationInfo:le})),[M,J,Z,k,le,V]),se=Object(n.useMemo)((()=>l.a.createElement(Ft,{packageInfo:V,defaultAgentPolicyId:v,agentPolicy:M,updateAgentPolicy:$,setHasAgentPolicyError:R,onNewAgentPolicyCreate:te})),[V,v,M,$,te]),re=Object(o.kb)(null!==(e=null===(t=C.package)||void 0===t?void 0:t.name)&&void 0!==e?e:"","package-policy-create"),oe=Object(n.useMemo)((()=>{var e;return G?l.a.createElement(y.k,null):V?l.a.createElement(l.a.Fragment,null,l.a.createElement(Tt.a,{agentPolicy:M,packageInfo:V,packagePolicy:C,updatePackagePolicy:Q,validationResults:D,submitAttempted:"INVALID"===z,integrationToEnable:null==le?void 0:le.name}),!re&&l.a.createElement(It.a,{packageInfo:V,showOnlyIntegration:null==le?void 0:le.name,packagePolicy:C,updatePackagePolicy:Q,validationResults:D,submitAttempted:"INVALID"===z}),re&&(null===(e=C.package)||void 0===e?void 0:e.name)&&l.a.createElement(y.h,null,l.a.createElement(re.Component,{newPolicy:C,onChange:Y}))):l.a.createElement("div",null)}),[G,M,V,C,Q,D,z,null==le?void 0:le.name,re,Y]),ce=[{title:d.i18n.translate("xpack.fleet.createPackagePolicy.stepConfigurePackagePolicyTitle",{defaultMessage:"Configure integration"}),"data-test-subj":"dataCollectionSetupStep",children:oe},{title:d.i18n.translate("xpack.fleet.createPackagePolicy.stepSelectAgentPolicyTitle",{defaultMessage:"Apply to agent policy"}),children:se}];return H?l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:H}):l.a.createElement(Mt.a,O()({},ie,{"data-test-subj":"createPackagePolicy"}),l.a.createElement(c.EuiErrorBoundary,null,"CONFIRM"===z&&M&&l.a.createElement(x.c,{agentCount:P,agentPolicy:M,onConfirm:ne,onCancel:()=>U("VALID")}),"SUBMITTED_NO_AGENTS"===z&&M&&V&&l.a.createElement(Mt.d,{packageInfo:V,agentPolicy:M,onConfirm:()=>ae(S,["openEnrollmentFlyout"]),onCancel:()=>ae(S,["showAddAgentHelp"])}),V&&l.a.createElement(At,{pkgTitle:(null==le?void 0:le.title)||V.title,pkgkey:Object(T.m)(V),integration:null==le?void 0:le.name}),l.a.createElement(Pt,{steps:ce}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(wt,{"data-test-subj":"integrationsBottomBar"},l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},M&&V&&"INVALID"===z?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorOnSaveText",defaultMessage:"Your integration policy has errors. Please fix them before saving."}):null),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",href:Z,onClick:J,"data-test-subj":"createPackagePolicyCancelButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.cancelButton",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{onClick:ne,isLoading:"LOADING"===z,disabled:"VALID"!==z||B,iconType:"save",color:"primary",fill:!0,"data-test-subj":"createPackagePolicySaveButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.saveButton",defaultMessage:"Save and continue"})))))))))},At=({pkgTitle:e,pkgkey:t,integration:a})=>(Object(o.L)("add_integration_to_policy",{pkgTitle:e,pkgkey:t,...a?{integration:a}:{}}),null),Lt=()=>{const e=Object(r.useHistory)(),{application:{navigateToApp:t}}=Object(o.jb)();return Object(n.useCallback)((a=>{if(a[0]===xt.sb){const{path:t="",state:n}=a[1]||{};e.push({pathname:"#"===t.charAt(0)?t.substr(1):t,state:n})}return t(...a)}),[e,t])};var _t=a(112);const Dt=e=>{const{onCancel:t,onConfirm:a,enrollmentKey:n}=e;return l.a.createElement(c.EuiConfirmModal,{title:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.title",{defaultMessage:"Revoke enrollment token"}),onCancel:t,onConfirm:a,cancelButtonText:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.deleteButton",{defaultMessage:"Revoke enrollment token"}),defaultFocusedButton:"confirm",buttonColor:"danger"},l.a.createElement(c.EuiCallOut,{title:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.description",{defaultMessage:"Are your sure you want to revoke {keyName}? New agents will no longer be able to be enrolled using this token.",values:{keyName:n.name}}),color:"danger"}))},Nt=({apiKeyId:e})=>{const{notifications:t}=Object(o.jb)(),[a,i]=Object(n.useState)("HIDDEN"),[s,r]=Object(n.useState)();return l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{color:"subdued",size:"xs"},"VISIBLE"===a?s:"•••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••")),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiToolTip,{content:"VISIBLE"===a?d.i18n.translate("xpack.fleet.enrollmentTokensList.hideTokenButtonLabel",{defaultMessage:"Hide token"}):d.i18n.translate("xpack.fleet.enrollmentTokensList.showTokenButtonLabel",{defaultMessage:"Show token"})},l.a.createElement(c.EuiButtonIcon,{"aria-label":"VISIBLE"===a?d.i18n.translate("xpack.fleet.enrollmentTokensList.hideTokenButtonLabel",{defaultMessage:"Hide token"}):d.i18n.translate("xpack.fleet.enrollmentTokensList.showTokenButtonLabel",{defaultMessage:"Show token"}),color:"text",onClick:async()=>{if("VISIBLE"===a)i("HIDDEN");else if("HIDDEN"===a)try{var n;i("LOADING");const t=await Object(o.t)(e);if(t.error)throw t.error;r(null===(n=t.data)||void 0===n?void 0:n.item.api_key),i("VISIBLE")}catch(e){t.toasts.addError(e,{title:"Error"}),i("HIDDEN")}},iconType:"VISIBLE"===a?"eyeClosed":"eye"}))))},Bt=({apiKey:e,refresh:t})=>{const{notifications:a}=Object(o.jb)(),[i,s]=Object(n.useState)("CONFIRM_HIDDEN");return l.a.createElement(l.a.Fragment,null,"CONFIRM_VISIBLE"===i&&l.a.createElement(Dt,{enrollmentKey:e,onCancel:()=>s("CONFIRM_HIDDEN"),onConfirm:async()=>{try{const t=await Object(o.m)(e.id);if(t.error)throw t.error}catch(e){a.toasts.addError(e,{title:"Error"})}s("CONFIRM_HIDDEN"),t()}}),l.a.createElement(c.EuiToolTip,{content:d.i18n.translate("xpack.fleet.enrollmentTokensList.revokeTokenButtonLabel",{defaultMessage:"Revoke token"})},l.a.createElement(c.EuiButtonIcon,{"aria-label":d.i18n.translate("xpack.fleet.enrollmentTokensList.revokeTokenButtonLabel",{defaultMessage:"Revoke token"}),onClick:()=>s("CONFIRM_VISIBLE"),iconType:"trash",color:"danger"})))},Rt=()=>{var e,t,a;Object(o.L)("enrollment_tokens");const[i,s]=Object(n.useState)(!1),[r,g]=Object(n.useState)(""),{pagination:m,setPagination:p,pageSizeOptions:f}=Object(o.fb)(),E=Object(o.S)({page:m.currentPage,perPage:m.pageSize,kuery:""!==r.trim()?r:void 0}),h=Object(o.Q)({page:1,perPage:1e3}),b=h.data?h.data.items:[],x=b.reduce(((e,t)=>(e[t.id]=t,e)),{}),M=null!==(e=null==E||null===(t=E.data)||void 0===t?void 0:t.total)&&void 0!==e?e:0,O=(null==E||null===(a=E.data)||void 0===a?void 0:a.list.filter((e=>{if(!b.length||!e.policy_id)return!1;const t=x[e.policy_id];return!(null!=t&&t.is_managed)})))||[],j=[{field:"name",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.nameTitle",{defaultMessage:"Name"}),render:e=>l.a.createElement("span",{className:"eui-textTruncate",title:e},e)},{field:"id",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.secretTitle",{defaultMessage:"Secret"}),width:"215px",render:e=>l.a.createElement(Nt,{apiKeyId:e})},{field:"policy_id",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.policyTitle",{defaultMessage:"Agent policy"}),render:e=>{const t=x[e],a=t?t.name:e;return l.a.createElement("span",{className:"eui-textTruncate",title:a},a)}},{field:"created_at",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.createdAtTitle",{defaultMessage:"Created on"}),width:"150px",render:e=>e?l.a.createElement(u.FormattedDate,{year:"numeric",month:"short",day:"2-digit",value:e}):null},{field:"active",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.activeTitle",{defaultMessage:"Active"}),width:"70px",align:"center",render:e=>l.a.createElement(c.EuiIcon,{size:"m",color:e?"success":"danger",type:"dot"})},{field:"actions",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.actionsTitle",{defaultMessage:"Actions"}),width:"70px",render:(e,t)=>{const a=b.find((e=>e.id===t.policy_id));return t.active&&!(null!=a&&a.is_managed)&&l.a.createElement(Bt,{apiKey:t,refresh:()=>E.resendRequest()})}}],S=E.isLoading&&E.isInitialRequest||h.isLoading&&h.isInitialRequest;return l.a.createElement(k.a,{section:"enrollment_tokens"},i&&l.a.createElement(y.l,{agentPolicies:b,onClose:e=>{s(!1),E.resendRequest()}}),l.a.createElement(c.EuiText,{color:"subdued"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollmentTokensList.pageDescription",defaultMessage:"Create and revoke enrollment tokens. An enrollment token enables one or more agents to enroll in Fleet and send data."})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiFlexGroup,{alignItems:"center"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(_t.a,{value:r,onChange:e=>{p({...m,currentPage:1}),g(e)},indexPattern:v.d})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>s(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollmentTokensList.newKeyButton",defaultMessage:"Create enrollment token"})))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiBasicTable,{loading:S,hasActions:!0,noItemsMessage:S?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollemntAPIKeyList.loadingTokensMessage",defaultMessage:"Loading enrollment tokens..."}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollemntAPIKeyList.emptyMessage",defaultMessage:"No enrollment tokens found."}),items:M?O:[],itemId:"id",columns:j,pagination:{pageIndex:m.currentPage-1,pageSize:m.pageSize,totalItemCount:M,pageSizeOptions:f},onChange:({page:e})=>{const t={...m,currentPage:e.index+1,pageSize:e.size};p(t)}}))},zt=({isAddIntegrationsPath:e,children:t})=>l.a.createElement(c.EuiErrorBoundary,null,e?l.a.createElement(k.c,{leftColumn:l.a.createElement(k.b,null)},t):l.a.createElement(k.a,null,l.a.createElement(k.d,null,t))),Ut=m()(c.EuiPanel).withConfig({displayName:"Panel",componentId:"sc-11e0awm-0"})(["max-width:500px;margin-right:auto;margin-left:auto;"]),qt=Object(n.memo)((({error:e})=>"MISSING_SECURITY"===e?l.a.createElement(ve.b,{missingRequirements:["security_required","api_keys"]}):"MISSING_SUPERUSER_ROLE"===e?l.a.createElement(Ut,null,l.a.createElement(c.EuiEmptyPrompt,{iconType:"securityApp",title:l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.permissionDeniedErrorTitle",defaultMessage:"Permission denied"})),body:l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.permissionDeniedErrorMessage",defaultMessage:"You are not authorized to access Fleet. Fleet requires {roleName} privileges.",values:{roleName:l.a.createElement(c.EuiCode,null,"superuser")}}))})):l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.permissionsRequestErrorMessageTitle",defaultMessage:"Unable to check permissions"}),error:d.i18n.translate("xpack.fleet.permissionsRequestErrorMessageDescription",{defaultMessage:"There was a problem checking Fleet permissions"})}))),Ht=Object(n.memo)((({children:e})=>{Object(o.L)("base");const{notifications:t}=Object(o.jb)(),[a,i]=Object(n.useState)(!1),[s,c]=Object(n.useState)(),[g,m]=Object(n.useState)(!1),[p,f]=Object(n.useState)(null),E=!!Object(r.useRouteMatch)(v.f.add_integration_to_policy);return Object(n.useEffect)((()=>{(async()=>{i(!1),c(void 0),m(!1),f(null);try{var e;i(!0);const s=await Object(o.w)();if(i(!1),null!==(e=s.data)&&void 0!==e&&e.success){try{var a,n;const e=await Object(o.G)();e.error&&f(e.error),null!==(a=e.data)&&void 0!==a&&null!==(n=a.nonFatalErrors)&&void 0!==n&&n.length&&t.toasts.addError(e.data.nonFatalErrors[0],{title:d.i18n.translate("xpack.fleet.setup.uiPreconfigurationErrorTitle",{defaultMessage:"Configuration error"})})}catch(e){f(e)}m(!0)}else{var l;c((null===(l=s.data)||void 0===l?void 0:l.error)||"REQUEST_ERROR")}}catch(e){c("REQUEST_ERROR")}})()}),[t.toasts]),a||s?l.a.createElement(zt,{isAddIntegrationsPath:E},a?l.a.createElement(y.k,null):l.a.createElement(qt,{error:s})):!g||p?l.a.createElement(zt,{isAddIntegrationsPath:E},p?l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.initializationErrorMessageTitle",defaultMessage:"Unable to initialize Fleet"}),error:p}):l.a.createElement(y.i,null)):l.a.createElement(l.a.Fragment,null,e)})),Gt=Object(n.memo)((({children:e,startServices:t,config:a,history:n,kibanaVersion:i,extensions:s,routerHistory:u})=>{const d=f()(t.uiSettings.get$("theme:darkMode"));return l.a.createElement(E.RedirectAppLinks,{application:t.application},l.a.createElement(t.i18n.Context,null,l.a.createElement(E.KibanaContextProvider,{services:{...t}},l.a.createElement(c.EuiErrorBoundary,null,l.a.createElement(o.b.Provider,{value:a},l.a.createElement(o.d.Provider,{value:i},l.a.createElement(h.EuiThemeProvider,{darkMode:d},l.a.createElement(o.f.Provider,{value:s},l.a.createElement(o.c,null,l.a.createElement(r.Router,{history:n},l.a.createElement(b.c,{notifications:t.notifications},e)))))))))))})),Vt=Object(n.memo)((({setHeaderActionMenu:e})=>{const{getModalHref:t}=Object(b.J)(),a=Object(o.jb)(),{TopNavMenu:n}=a.navigation.ui,i=[{label:d.i18n.translate("xpack.fleet.appNavigation.sendFeedbackButton",{defaultMessage:"Send Feedback"}),iconType:"popout",run:()=>window.open("https://ela.st/fleet-feedback")},{label:d.i18n.translate("xpack.fleet.appNavigation.settingsButton",{defaultMessage:"Fleet settings"}),iconType:"gear",run:()=>a.application.navigateToUrl(t("settings"))}];return l.a.createElement(n,{appName:d.i18n.translate("xpack.fleet.appTitle",{defaultMessage:"Fleet"}),config:i,setMenuMountPoint:e})})),$t=Object(n.memo)((({setHeaderActionMenu:e})=>{const{modal:t,setModal:a}=Object(b.J)();return l.a.createElement(l.a.Fragment,null,l.a.createElement(Vt,{setHeaderActionMenu:e}),"settings"===t&&l.a.createElement(c.EuiPortal,null,l.a.createElement(y.p,{onClose:()=>{a(null)}})),l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:v.f.agents},l.a.createElement(vt,null)),l.a.createElement(r.Route,{path:v.f.policies},l.a.createElement($,null)),l.a.createElement(r.Route,{path:v.f.enrollment_tokens},l.a.createElement(Rt,null)),l.a.createElement(r.Route,{path:v.f.data_streams},l.a.createElement(Q,null)),l.a.createElement(r.Route,{path:v.f.add_integration_to_policy},l.a.createElement(Ct,null)),l.a.createElement(r.Route,{render:({location:e})=>{if(!(""===e.pathname&&e.hash.length>0))return l.a.createElement(r.Redirect,{to:v.f.agents});const t=e.hash.replace(/^#(\/fleet)?/,"");return l.a.createElement(r.Redirect,{to:{...e,pathname:t,hash:void 0}})}})))})),Wt=({isAllowed:e=!1,restrictedPath:t="/",...a})=>e?l.a.createElement(r.Route,a):l.a.createElement(r.Redirect,{to:{pathname:t}}),Kt=({basepath:e,startServices:t,config:a,history:n,kibanaVersion:i,extensions:s,setHeaderActionMenu:r})=>l.a.createElement(Gt,{basepath:e,startServices:t,config:a,history:n,kibanaVersion:i,extensions:s},l.a.createElement(Ht,null,l.a.createElement($t,{setHeaderActionMenu:r})));function Qt(e,{element:t,appBasePath:a,history:n,setHeaderActionMenu:i},r,o,c){return s.a.render(l.a.createElement(Kt,{basepath:a,startServices:e,config:r,history:n,kibanaVersion:o,extensions:c,setHeaderActionMenu:i}),t),()=>{s.a.unmountComponentAtNode(t)}}const Yt=e=>{e.chrome.docTitle.reset(),e.chrome.setBreadcrumbs([]),o.g.stop()}}}]);