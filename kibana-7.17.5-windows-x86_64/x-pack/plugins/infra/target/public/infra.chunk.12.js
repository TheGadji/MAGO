/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[12],{131:function(e,t,a){"use strict";a.d(t,"i",(function(){return p})),a.d(t,"d",(function(){return b})),a.d(t,"f",(function(){return f})),a.d(t,"j",(function(){return E})),a.d(t,"k",(function(){return g})),a.d(t,"h",(function(){return h})),a.d(t,"g",(function(){return x})),a.d(t,"a",(function(){return y})),a.d(t,"e",(function(){return j})),a.d(t,"c",(function(){return O})),a.d(t,"b",(function(){return k}));var l=a(2),r=a.n(l),i=a(65),n=a(28),o=a(63),s=a.n(o),c=a(1),u=a(12),m=a(17),d=a(11);const p={headerFormatter:e=>s()(e.value).format("Y-MM-DD HH:mm:ss")},b=20,f={s:c.i18n.translate("xpack.infra.alerts.timeLabels.seconds",{defaultMessage:"seconds"}),m:c.i18n.translate("xpack.infra.alerts.timeLabels.minutes",{defaultMessage:"minutes"}),h:c.i18n.translate("xpack.infra.alerts.timeLabels.hours",{defaultMessage:"hours"}),d:c.i18n.translate("xpack.infra.alerts.timeLabels.days",{defaultMessage:"days"})},E=(e,t)=>Object(l.useMemo)((()=>"number"==typeof e&&"number"==typeof t?Object(i.niceTimeFormatter)([e,t]):e=>`${e}`),[e,t]),g=d.a,h=(e,t=!1)=>{let a=null,l=null;const r=e.reduce(((e,t)=>(t.points.forEach((t=>{const a=e[t.timestamp]||[];e[t.timestamp]=[...a,t.value]})),e)),{});Object.values(r).forEach((e=>{const r=t?Object(n.sum)(e):Object(n.max)(e),i=Object(n.min)(e);r&&(!l||r>l)&&(l=r),i&&(!a||i<a)&&(a=i)}));const i=Object.keys(r).map(Number),o=Object(n.min)(i)||0,s=Object(n.max)(i)||0;return{yMin:a||0,yMax:l||0,xMin:o,xMax:s}},x=e=>e?i.DARK_THEME:i.LIGHT_THEME,v=({children:e})=>r.a.createElement("div",{style:{width:"100%",height:150,display:"flex",justifyContent:"center",alignItems:"center"}},e),y=({children:e})=>r.a.createElement("div",{style:{width:"100%",height:150}},e),j=()=>r.a.createElement(v,null,r.a.createElement(u.EuiText,{color:"subdued","data-test-subj":"noChartData"},r.a.createElement(m.FormattedMessage,{id:"xpack.infra.alerts.charts.noDataMessage",defaultMessage:"No chart data available"}))),O=()=>r.a.createElement(v,null,r.a.createElement(u.EuiText,{color:"subdued","data-test-subj":"loadingData"},r.a.createElement(m.FormattedMessage,{id:"xpack.infra.alerts.charts.loadingMessage",defaultMessage:"Loading"}))),k=()=>r.a.createElement(v,null,r.a.createElement(u.EuiText,{color:"subdued","data-test-subj":"chartErrorState"},r.a.createElement(m.FormattedMessage,{id:"xpack.infra.alerts.charts.errorMessage",defaultMessage:"Uh oh, something went wrong"})))},177:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var l=a(2),r=a.n(l),i=a(28),n=a(65),o=a(23),s=a(89);const c=.3,u=({threshold:e,sortedThresholds:t,comparator:a,color:l,id:u,firstTimestamp:m,lastTimestamp:d,domain:p})=>{if(!a||!e)return null;const b=[o.a.GT,o.a.GT_OR_EQ].includes(a),f=[o.a.LT,o.a.LT_OR_EQ].includes(a);return r.a.createElement(r.a.Fragment,null,r.a.createElement(n.LineAnnotation,{id:`${u}-thresholds`,domainType:n.AnnotationDomainType.YDomain,"data-test-subj":"threshold-line",dataValues:t.map((e=>({dataValue:e}))),style:{line:{strokeWidth:2,stroke:Object(s.b)(l),opacity:1}}}),2===t.length&&a===o.a.BETWEEN?r.a.createElement(r.a.Fragment,null,r.a.createElement(n.RectAnnotation,{id:`${u}-lower-threshold`,"data-test-subj":"between-rect",style:{fill:Object(s.b)(l),opacity:c},dataValues:[{coordinates:{x0:m,x1:d,y0:Object(i.first)(e),y1:Object(i.last)(e)}}]})):null,2===t.length&&a===o.a.OUTSIDE_RANGE?r.a.createElement(r.a.Fragment,null,r.a.createElement(n.RectAnnotation,{id:`${u}-lower-threshold`,"data-test-subj":"outside-range-lower-rect",style:{fill:Object(s.b)(l),opacity:c},dataValues:[{coordinates:{x0:m,x1:d,y0:p.min,y1:Object(i.first)(e)}}]}),r.a.createElement(n.RectAnnotation,{id:`${u}-upper-threshold`,"data-test-subj":"outside-range-upper-rect",style:{fill:Object(s.b)(l),opacity:c},dataValues:[{coordinates:{x0:m,x1:d,y0:Object(i.last)(e),y1:p.max}}]})):null,f&&null!=Object(i.first)(e)?r.a.createElement(n.RectAnnotation,{id:`${u}-upper-threshold`,"data-test-subj":"below-rect",style:{fill:Object(s.b)(l),opacity:c},dataValues:[{coordinates:{x0:m,x1:d,y0:p.min,y1:Object(i.first)(e)}}]}):null,b&&null!=Object(i.first)(e)?r.a.createElement(n.RectAnnotation,{id:`${u}-upper-threshold`,"data-test-subj":"above-rect",style:{fill:Object(s.b)(l),opacity:c},dataValues:[{coordinates:{x0:m,x1:d,y0:Object(i.first)(e),y1:p.max}}]}):null)}},297:function(e,t,a){"use strict";a.r(t),a.d(t,"defaultExpression",(function(){return J})),a.d(t,"Expressions",(function(){return X})),a.d(t,"ExpressionRow",(function(){return le})),a.d(t,"nodeTypes",(function(){return ne}));var l=a(28),r=a(2),i=a.n(r),n=a(12),o=a(17),s=a(1),c=a(152),u=a(23),m=a(16),d=a(81),p=a(24),b=a(149),f=a(132),E=a(222),g=a(219),h=a(220),x=a(221),v=a(216),y=a(217),j=a(218),O=a(91),k=a(88),w=a(120),T=a(93);const C={avg:s.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.avg",{defaultMessage:"Average"}),max:s.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.max",{defaultMessage:"Max"}),min:s.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.min",{defaultMessage:"Min"}),rate:s.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.rate",{defaultMessage:"Rate"})},M=T.b.map((e=>({text:C[e],value:e}))),F=({metric:e,metrics:t,customMetric:a,fields:c,errors:u,onChange:m,onChangeCustom:d,popupPosition:p})=>{var b;const[f,E]=Object(r.useState)(!1),[g,h]=Object(r.useState)("custom"===(null==e?void 0:e.value)),[x,v]=Object(r.useState)(null==e?void 0:e.value),[y,j]=Object(r.useState)(null==a?void 0:a.label),O={text:s.i18n.translate("xpack.infra.metrics.alertFlyout.expression.metric.selectFieldLabel",{defaultMessage:"Select a metric"}),value:""},k=Object(r.useMemo)((()=>c.filter((e=>e.aggregatable&&"number"===e.type&&!((null==a?void 0:a.field)===e.name))).map((e=>({label:e.name})))),[c,null==a?void 0:a.field]),C=Object(r.useMemo)((()=>g?(null==a?void 0:a.field)&&Object(w.a)(a):(null==e?void 0:e.text)||O.text),[g,e,a,O]),F=Object(r.useCallback)((e=>{"metric-popover-custom"===e?(h(!0),m("custom")):(h(!1),m(x))}),[h,m,x]),I=Object(r.useCallback)((e=>{const t=e.target.value,l=T.c.is(t)?t:"avg",r={...a,aggregation:l};T.d.is(r)&&d(r)}),[a,d]),L=Object(r.useCallback)((e=>{const t={...a,field:e[0].label};T.d.is(t)&&d(t)}),[a,d]),z=Object(l.debounce)(d,500),R=Object(r.useCallback)((e=>{j(e.target.value);const t={...a,label:e.target.value};T.d.is(t)&&z(t)}),[a,z]),W=t.map((e=>({label:e.text,value:e.value})),[]);return i.a.createElement(n.EuiPopover,{id:"metricPopover",button:i.a.createElement(n.EuiExpression,{description:s.i18n.translate("xpack.infra.metrics.alertFlyout.expression.metric.whenLabel",{defaultMessage:"When"}),value:C,isActive:Boolean(f||u.metric&&u.metric.length>0),onClick:()=>{E(!0)},color:null!==(b=u.metric)&&void 0!==b&&b.length?"danger":"secondary"}),isOpen:f,closePopover:()=>{E(!1)},anchorPosition:null!=p?p:"downRight",zIndex:8e3},i.a.createElement("div",{style:{width:620}},i.a.createElement(S,{onClose:()=>E(!1)},i.a.createElement(o.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.expression.metric.popoverTitle",defaultMessage:"Metric"})),i.a.createElement(n.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:"Metric type",options:[{id:"metric-popover-default",label:"Default metric"},{id:"metric-popover-custom",label:"Custom metric"}],idSelected:g?"metric-popover-custom":"metric-popover-default",onChange:F}),i.a.createElement(n.EuiSpacer,{size:"m"}),g?i.a.createElement(i.a.Fragment,null,i.a.createElement(n.EuiFormRow,{fullWidth:!0},i.a.createElement(n.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},i.a.createElement(n.EuiFlexItem,{grow:!1},i.a.createElement(n.EuiSelect,{onChange:I,value:(null==a?void 0:a.aggregation)||"avg",options:M,fullWidth:!0})),i.a.createElement(n.EuiFlexItem,{grow:!1},i.a.createElement(n.EuiText,{color:"subdued"},i.a.createElement("span",null,s.i18n.translate("xpack.infra.waffle.customMetrics.of",{defaultMessage:"of"})))),i.a.createElement(n.EuiFlexItem,null,i.a.createElement(n.EuiComboBox,{fullWidth:!0,placeholder:s.i18n.translate("xpack.infra.waffle.customMetrics.fieldPlaceholder",{defaultMessage:"Select a field"}),singleSelection:{asPlainText:!0},selectedOptions:null!=a&&a.field?[{label:a.field}]:[],options:k,onChange:L,isClearable:!1,isInvalid:u.metric.length>0})))),i.a.createElement(n.EuiFormRow,{label:s.i18n.translate("xpack.infra.waffle.alerting.customMetrics.labelLabel",{defaultMessage:"Metric name (optional)"}),display:"rowCompressed",fullWidth:!0,helpText:s.i18n.translate("xpack.infra.waffle.alerting.customMetrics.helpText",{defaultMessage:'Choose a name to help identify your custom metric. Defaults to "<function> of <field name>".'})},i.a.createElement(n.EuiFieldText,{name:"label",placeholder:s.i18n.translate("xpack.infra.waffle.customMetrics.labelPlaceholder",{defaultMessage:'Choose a name to appear in the "Metric" dropdown'}),value:y,fullWidth:!0,onChange:R}))):i.a.createElement(n.EuiFormRow,{fullWidth:!0},i.a.createElement(n.EuiFlexGroup,null,i.a.createElement(n.EuiFlexItem,{className:"actOf__metricContainer"},i.a.createElement(n.EuiComboBox,{fullWidth:!0,singleSelection:{asPlainText:!0},"data-test-subj":"availablefieldsOptionsComboBox",isInvalid:u.metric.length>0,placeholder:O.text,options:W,noSuggestions:!W.length,selectedOptions:e?W.filter((t=>t.value===e.value)):[],renderOption:e=>e.label,onChange:e=>{e.length>0?(m(e[0].value),v(e[0].value)):m()}}))))))},S=({children:e,onClose:t})=>i.a.createElement(n.EuiPopoverTitle,null,i.a.createElement(n.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},i.a.createElement(n.EuiFlexItem,null,e),i.a.createElement(n.EuiFlexItem,{grow:!1},i.a.createElement(n.EuiButtonIcon,{iconType:"cross",color:"danger","aria-label":s.i18n.translate("xpack.infra.metrics.expressionItems.components.closablePopoverTitle.closeLabel",{defaultMessage:"Close"}),onClick:()=>t()})))),I=({value:e,options:t,onChange:a,popupPosition:l})=>{const[c,u]=Object(r.useState)(!1);return i.a.createElement(n.EuiPopover,{button:i.a.createElement(n.EuiExpression,{"data-test-subj":"nodeTypeExpression",description:s.i18n.translate("xpack.infra.metrics.alertFlyout.expression.for.descriptionLabel",{defaultMessage:"For"}),value:t[e].text,isActive:c,onClick:()=>{u(!0)}}),isOpen:c,closePopover:()=>{u(!1)},ownFocus:!0,anchorPosition:null!=l?l:"downLeft"},i.a.createElement("div",null,i.a.createElement(L,{onClose:()=>u(!1)},i.a.createElement(o.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.expression.for.popoverTitle",defaultMessage:"Node Type"})),i.a.createElement(n.EuiSelect,{"data-test-subj":"forExpressionSelect",value:e,fullWidth:!0,onChange:e=>{a(e.target.value),u(!1)},options:Object.values(t).map((e=>e))})))},L=({children:e,onClose:t})=>i.a.createElement(n.EuiPopoverTitle,null,i.a.createElement(n.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},i.a.createElement(n.EuiFlexItem,null,e),i.a.createElement(n.EuiFlexItem,{grow:!1},i.a.createElement(n.EuiButtonIcon,{iconType:"cross",color:"danger","aria-label":s.i18n.translate("xpack.infra.metrics.expressionItems.components.closablePopoverTitle.closeLabel",{defaultMessage:"Close"}),onClick:()=>t()}))));var z=a(112),R=a(19),W=a(65),P=a(63),A=a.n(P),D=a(89),B=a(118),Q=a(94),U=a(119),G=a(148),_=a(150),N=a(151),$=a(131),H=a(177),V=a(90);const q=({expression:e,filterQuery:t,nodeType:a,sourceId:s})=>{var c,u,m,d,p;const b=Object(r.useMemo)((()=>({interval:`${e.timeSize||1}${e.timeUnit}`,from:A()().subtract(20*(e.timeSize||1),e.timeUnit).valueOf(),to:A()().valueOf(),forceInterval:!0,ignoreLookback:!0})),[e.timeSize,e.timeUnit]),f=e=>({...e,type:"custom"}),E=Object(V.d)(),{loading:g,nodes:h}=Object(_.a)(t,"custom"===e.metric?[f(e.customMetric)]:[{type:e.metric}],[],a,s,0,E.accountId,E.region,!0,b),{uiSettings:x}=Object(R.b)().services,v={field:e.metric,aggregation:"avg",color:D.a.color0},y=(null==x?void 0:x.get("theme:darkMode"))||!1,j=Object(r.useMemo)((()=>{var e,t,a,r;const i=null===(e=h[0])||void 0===e||null===(t=e.metrics[0])||void 0===t?void 0:t.timeseries,n=null===(a=Object(l.first)(null==i?void 0:i.rows))||void 0===a?void 0:a.timestamp,o=null===(r=Object(l.last)(null==i?void 0:i.rows))||void 0===r?void 0:r.timestamp;return null==n||null==o?e=>`${e}`:Object(W.niceTimeFormatter)([n,o])}),[h]),O=Object(r.useCallback)(Object(N.a)("custom"===e.metric?f(e.customMetric):{type:e.metric}),[e.metric]);if(g||!h)return i.a.createElement($.c,null);const k=t=>K(e.metric,t),w=e.threshold.map(k),T=null!==(c=null===(u=e.warningThreshold)||void 0===u?void 0:u.map(k))&&void 0!==c?c:[],C=w.slice().sort(),M=T.slice().sort(),F=[...C,...M].sort(),S=null===(m=h[0])||void 0===m||null===(d=m.metrics[0])||void 0===d?void 0:d.timeseries;if(!S||!S.rows||0===S.rows.length)return i.a.createElement($.e,null);const I={...S,id:null===(p=h[0])||void 0===p?void 0:p.name,rows:S.rows.map((e=>{const t={...e};return F.forEach(((e,a)=>{t[Object(G.a)(v,`threshold_${a}`)]=e})),t}))},L=Object(l.first)(S.rows).timestamp,z=Object(l.last)(S.rows).timestamp,P=Object(U.a)(I,[v],!1),q={max:1.1*Math.max(P.max,Object(l.last)(F)||P.max),min:.9*Math.min(P.min,Object(l.first)(F)||P.min)};q.min===Object(l.first)(w)&&(q.min=.9*q.min);const{timeSize:Y,timeUnit:J}=e,X=$.f[J];return i.a.createElement(i.a.Fragment,null,i.a.createElement($.a,null,i.a.createElement(W.Chart,null,i.a.createElement(B.a,{type:Q.b.bar,metric:v,id:"0",series:I,stack:!1}),i.a.createElement(H.a,{comparator:e.comparator,threshold:w,sortedThresholds:C,color:D.a.color1,id:"critical",firstTimestamp:L,lastTimestamp:z,domain:q}),e.warningComparator&&e.warningThreshold&&i.a.createElement(H.a,{comparator:e.warningComparator,threshold:T,sortedThresholds:M,color:D.a.color5,id:"warning",firstTimestamp:L,lastTimestamp:z,domain:q}),i.a.createElement(W.Axis,{id:"timestamp",position:W.Position.Bottom,showOverlappingTicks:!0,tickFormat:j}),i.a.createElement(W.Axis,{id:"values",position:W.Position.Left,tickFormat:O,domain:q}),i.a.createElement(W.Settings,{tooltip:$.i,theme:Object($.g)(y)}))),i.a.createElement("div",{style:{textAlign:"center"}},"ALL"!==I.id?i.a.createElement(n.EuiText,{size:"xs",color:"subdued"},i.a.createElement(o.FormattedMessage,{id:"xpack.infra.metrics.alerts.dataTimeRangeLabelWithGrouping",defaultMessage:"Last {lookback} {timeLabel} of data for {id}",values:{id:I.id,timeLabel:X,lookback:20*Y}})):i.a.createElement(n.EuiText,{size:"xs",color:"subdued"},i.a.createElement(o.FormattedMessage,{id:"xpack.infra.metrics.alerts.dataTimeRangeLabel",defaultMessage:"Last {lookback} {timeLabel}",values:{timeLabel:X,lookback:20*Y}}))))},K=(e,t)=>Y[e]?Y[e](t):t,Y={cpu:e=>Number(e)/100,memory:e=>Number(e)/100},J={metric:"cpu",comparator:u.a.GT,threshold:[],timeSize:1,timeUnit:"m",customMetric:{type:"custom",id:"alert-custom-metric",field:"",aggregation:"avg"}},X=e=>{const{http:t,notifications:a}=Object(R.b)().services,{setAlertParams:c,alertParams:u,errors:m,metadata:E}=e,{source:g,createDerivedIndexPattern:h}=Object(f.a)({sourceId:"default",fetch:t.fetch,toastWarning:a.toasts.addWarning}),[x,v]=Object(r.useState)(1),[y,j]=Object(r.useState)("m"),O=Object(r.useMemo)((()=>h()),[h]),k=Object(r.useCallback)(((e,t)=>{const a=u.criteria?u.criteria.slice():[];a[e]=t,c("criteria",a)}),[c,u.criteria]),w=Object(r.useCallback)((()=>{var e;const t=(null===(e=u.criteria)||void 0===e?void 0:e.slice())||[];t.push({...J,timeSize:null!=x?x:J.timeSize,timeUnit:null!=y?y:J.timeUnit}),c("criteria",t)}),[c,u.criteria,x,y]),C=Object(r.useCallback)((e=>{const t=u.criteria.slice();t.length>1&&(t.splice(e,1),c("criteria",t))}),[c,u.criteria]),M=Object(r.useCallback)((e=>{c("filterQueryText",e||"");try{c("filterQuery",Object(z.a)(e,O,!1)||"")}catch(e){c("filterQuery",p.e)}}),[O,c]),F=Object(r.useCallback)(Object(l.debounce)(M,500),[M]),S=Object(r.useMemo)((()=>({aggField:[],timeSizeUnit:[],timeWindowSize:[]})),[]),L=Object(r.useCallback)((e=>{const t=u.criteria.map((t=>({...t,timeSize:e})));v(e||void 0),c("criteria",t)}),[u.criteria,c]),W=Object(r.useCallback)((e=>{const t=u.criteria.map((t=>({...t,timeUnit:e})));j(e),c("criteria",t)}),[u.criteria,c]),P=Object(r.useCallback)((e=>{c("nodeType",e)}),[c]),A=Object(r.useCallback)((e=>M(e.target.value)),[M]),D=Object(r.useCallback)((()=>{const e=E;e&&e.options?c("criteria",[{...J,metric:e.options.metric.type,customMetric:T.d.is(e.options.metric)?e.options.metric:J.customMetric}]):c("criteria",[J])}),[E,c]),B=Object(r.useCallback)((()=>{const e=E;e&&e.filter&&(c("filterQueryText",e.filter),c("filterQuery",Object(z.a)(e.filter,O)||""))}),[E,O,c]);return Object(r.useEffect)((()=>{const e=E;u.nodeType||(e&&e.nodeType?c("nodeType",e.nodeType):c("nodeType","host")),u.criteria&&u.criteria.length?(v(u.criteria[0].timeSize),j(u.criteria[0].timeUnit)):D(),u.filterQuery||B(),u.sourceId||c("sourceId",(null==g?void 0:g.id)||"default")}),[E,O,J,g]),i.a.createElement(i.a.Fragment,null,i.a.createElement(n.EuiSpacer,{size:"m"}),i.a.createElement(n.EuiText,{size:"xs"},i.a.createElement("h4",null,i.a.createElement(o.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.conditions",defaultMessage:"Conditions"}))),i.a.createElement(te,null,i.a.createElement(ee,null,i.a.createElement(Z,null,i.a.createElement(I,{options:ne,value:u.nodeType||"host",onChange:P})))),i.a.createElement(n.EuiSpacer,{size:"xs"}),u.criteria&&u.criteria.map(((e,t)=>i.a.createElement(le,{nodeType:u.nodeType,canDelete:u.criteria.length>1,remove:C,addExpression:w,key:t,expressionId:t,setAlertParams:k,errors:m[t]||S,expression:e||{},fields:O.fields},i.a.createElement(q,{expression:e,filterQuery:u.filterQuery,nodeType:u.nodeType,sourceId:u.sourceId,"data-test-subj":"preview-chart"})))),i.a.createElement(Z,null,i.a.createElement(d.ForLastExpression,{timeWindowSize:x,timeWindowUnit:y,errors:S,onChangeWindowSize:L,onChangeWindowUnit:W})),i.a.createElement("div",null,i.a.createElement(n.EuiButtonEmpty,{color:"primary",iconSide:"left",flush:"left",iconType:"plusInCircleFilled",onClick:w},i.a.createElement(o.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.addCondition",defaultMessage:"Add condition"}))),i.a.createElement(n.EuiSpacer,{size:"m"}),i.a.createElement(n.EuiCheckbox,{id:"metrics-alert-no-data-toggle",label:i.a.createElement(i.a.Fragment,null,s.i18n.translate("xpack.infra.metrics.alertFlyout.alertOnNoData",{defaultMessage:"Alert me if there's no data"})," ",i.a.createElement(n.EuiToolTip,{content:s.i18n.translate("xpack.infra.metrics.alertFlyout.noDataHelpText",{defaultMessage:"Enable this to trigger the action if the metric(s) do not report any data over the expected time period, or if the alert fails to query Elasticsearch"})},i.a.createElement(n.EuiIcon,{type:"questionInCircle",color:"subdued"}))),checked:u.alertOnNoData,onChange:e=>c("alertOnNoData",e.target.checked)}),i.a.createElement(n.EuiSpacer,{size:"m"}),i.a.createElement(n.EuiFormRow,{label:s.i18n.translate("xpack.infra.metrics.alertFlyout.filterLabel",{defaultMessage:"Filter (optional)"}),helpText:s.i18n.translate("xpack.infra.metrics.alertFlyout.filterHelpText",{defaultMessage:"Use a KQL expression to limit the scope of your alert trigger."}),fullWidth:!0,display:"rowCompressed"},E&&i.a.createElement(b.a,{derivedIndexPattern:O,onSubmit:M,onChange:F,value:u.filterQueryText})||i.a.createElement(n.EuiFieldSearch,{onChange:A,value:u.filterQueryText,fullWidth:!0})),i.a.createElement(n.EuiSpacer,{size:"m"}))};t.default=X;const Z=m.euiStyled.div`
  margin-left: 28px;
`,ee=Object(m.euiStyled)(n.EuiFlexGroup)`
  display: flex;
  flex-wrap: wrap;
  margin: 0 -4px;
`,te=m.euiStyled.div`
  padding: 0 4px;
`,ae=Object(m.euiStyled)(n.EuiHealth)`
  margin-left: 4px;
`,le=e=>{var t,a,m;const[d,p]=Object(r.useState)(!0),b=Object(r.useCallback)((()=>p(!d)),[d]),{children:f,setAlertParams:O,expression:w,errors:C,expressionId:M,remove:S,canDelete:I,fields:L}=e,{metric:z,comparator:R=u.a.GT,threshold:W=[],customMetric:P,warningThreshold:A=[],warningComparator:D}=w,[B,Q]=Object(r.useState)(Boolean(null==A?void 0:A.length)),U=Object(r.useCallback)((e=>{const t=k.f.is(e)?e:Boolean(e)?"custom":void 0,a={...w,metric:t};O(M,a)}),[M,w,O]),G=Object(r.useCallback)((e=>{T.d.is(e)&&O(M,{...w,customMetric:e})}),[M,w,O]),_=Object(r.useCallback)((e=>{O(M,{...w,comparator:e})}),[M,w,O]),N=Object(r.useCallback)((e=>{O(M,{...w,warningComparator:e})}),[M,w,O]),$=Object(r.useCallback)((e=>{e.join()!==w.threshold.join()&&O(M,{...w,threshold:e})}),[M,w,O]),H=Object(r.useCallback)((e=>{var t;e.join()!==(null===(t=w.warningThreshold)||void 0===t?void 0:t.join())&&O(M,{...w,warningThreshold:e})}),[M,w,O]),V=Object(r.useCallback)((()=>{B?(Q(!1),O(M,Object(l.omit)(w,"warningComparator","warningThreshold"))):(Q(!0),O(M,{...w,warningComparator:R,warningThreshold:[]}))}),[B,Q,O,R,w,M]),q=i.a.createElement(re,{comparator:R,threshold:W,updateComparator:_,updateThreshold:$,errors:null!==(t=C.critical)&&void 0!==t?t:{},metric:z}),K=B&&i.a.createElement(re,{comparator:D||R,threshold:A,updateComparator:N,updateThreshold:H,errors:null!==(a=C.warning)&&void 0!==a?a:{},metric:z}),Y=Object(r.useMemo)((()=>{let t=v.b;switch(e.nodeType){case"awsEC2":t=g.b;break;case"awsRDS":t=x.b;break;case"awsS3":t=h.b;break;case"awsSQS":t=E.b;break;case"host":t=v.b;break;case"pod":t=j.b;break;case"container":t=y.b}return t.map(c.a)}),[e.nodeType]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.EuiFlexGroup,{gutterSize:"xs"},i.a.createElement(n.EuiFlexItem,{grow:!1},i.a.createElement(n.EuiButtonIcon,{iconType:d?"arrowDown":"arrowRight",onClick:b,"aria-label":s.i18n.translate("xpack.infra.metrics.alertFlyout.expandRowLabel",{defaultMessage:"Expand row."})})),i.a.createElement(n.EuiFlexItem,{grow:!0},i.a.createElement(ee,null,i.a.createElement(te,null,i.a.createElement(F,{metric:{value:z,text:(null===(m=Y.find((e=>(null==e?void 0:e.value)===z)))||void 0===m?void 0:m.text)||""},metrics:Y.filter((e=>void 0!==e&&void 0!==e.value)),onChange:U,onChangeCustom:G,errors:C,customMetric:P,fields:L})),!B&&q),B&&i.a.createElement(i.a.Fragment,null,i.a.createElement(ee,null,q,i.a.createElement(ae,{color:"danger"},i.a.createElement(o.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.criticalThreshold",defaultMessage:"Alert"}))),i.a.createElement(ee,null,K,i.a.createElement(ae,{color:"warning"},i.a.createElement(o.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.warningThreshold",defaultMessage:"Warning"})),i.a.createElement(n.EuiButtonIcon,{"aria-label":s.i18n.translate("xpack.infra.metrics.alertFlyout.removeWarningThreshold",{defaultMessage:"Remove warningThreshold"}),iconSize:"s",color:"subdued",iconType:"crossInACircleFilled",onClick:V}))),!B&&i.a.createElement(i.a.Fragment,null," ",i.a.createElement(n.EuiSpacer,{size:"xs"}),i.a.createElement(ee,null,i.a.createElement(n.EuiButtonEmpty,{color:"primary",flush:"left",size:"xs",iconType:"plusInCircleFilled",onClick:V},i.a.createElement(o.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.addWarningThreshold",defaultMessage:"Add warning threshold"}))))),I&&i.a.createElement(n.EuiFlexItem,{grow:!1},i.a.createElement(n.EuiButtonIcon,{"aria-label":s.i18n.translate("xpack.infra.metrics.alertFlyout.removeCondition",{defaultMessage:"Remove condition"}),color:"danger",iconType:"trash",onClick:()=>S(M)}))),d?i.a.createElement("div",{style:{padding:"0 0 0 28px"}},f):null,i.a.createElement(n.EuiSpacer,{size:"s"}))},re=({updateComparator:e,updateThreshold:t,threshold:a,metric:l,comparator:r,errors:o})=>{var s;return i.a.createElement(i.a.Fragment,null,i.a.createElement(te,null,i.a.createElement(d.ThresholdExpression,{thresholdComparator:r||u.a.GT,threshold:a,onChangeSelectedThresholdComparator:e,onChangeSelectedThreshold:t,errors:o})),l&&i.a.createElement("div",{style:{alignSelf:"center"}},i.a.createElement(n.EuiText,{size:"s"},(null===(s=oe[l])||void 0===s?void 0:s.label)||"")))},ie=e=>Object(O.b)(e).displayName,ne={host:{text:ie("host"),value:"host"},pod:{text:ie("pod"),value:"pod"},container:{text:ie("container"),value:"container"},awsEC2:{text:ie("awsEC2"),value:"awsEC2"},awsS3:{text:ie("awsS3"),value:"awsS3"},awsRDS:{text:ie("awsRDS"),value:"awsRDS"},awsSQS:{text:ie("awsSQS"),value:"awsSQS"}},oe={count:{label:""},cpu:{label:"%"},memory:{label:"%"},rx:{label:"bits/s"},tx:{label:"bits/s"},logRate:{label:"/s"},diskIOReadBytes:{label:"bytes/s"},diskIOWriteBytes:{label:"bytes/s"},s3BucketSize:{label:"bytes"},s3TotalRequests:{label:""},s3NumberOfObjects:{label:""},s3UploadBytes:{label:"bytes"},s3DownloadBytes:{label:"bytes"},sqsOldestMessage:{label:"seconds"},rdsLatency:{label:"ms"},custom:{label:""}}}}]);