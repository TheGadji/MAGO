/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[21],{50:function(t,e,s){"use strict";s.r(e),s.d(e,"AlertEdit",(function(){return A})),s.d(e,"default",(function(){return A}));var a=s(1),i=s.n(a),c=s(36),n=s(13),r=s(3),l=s(0),o=s(14),u=s(146),d=s(143),j=s(97),b=s(83),g=s(99),O=s(86),E=s(59),x=s(144),p=s(145),y=s(4),f=s(5);const A=({initialAlert:t,onClose:e,reloadAlerts:s,onSave:A,ruleTypeRegistry:m,actionTypeRegistry:T,metadata:h,...C})=>{const F=null!=A?A:s,[{alert:v},S]=Object(a.useReducer)(j.a,{alert:Object(r.cloneDeep)(t)}),[w,k]=Object(a.useState)(!1),[B,I]=Object(a.useState)(!1),[U,M]=Object(a.useState)(!1),[D,N]=Object(a.useState)(!1),[L,z]=Object(a.useState)([]),[R,_]=Object(a.useState)(!1),[H,W]=Object(a.useState)(C.ruleType),{http:P,notifications:{toasts:G}}=Object(E.b)().services,V=m.get(v.alertTypeId);Object(a.useEffect)((()=>{(async()=>{_(!0);const t=await Object(d.a)(v,T);z([...t]),_(!1)})()}),[v,T]),Object(a.useEffect)((()=>{C.ruleType||H||(async()=>{const t=await Object(b.l)({http:P});for(const e of t)V.id===e.id&&W(e)})()}),[C.ruleType,V.id,H,P]);const{alertBaseErrors:q,alertErrors:J,alertParamsErrors:K}=Object(d.b)(v,V,H),Q=()=>{Object(p.a)(v,t,!0)?N(!0):e(o.b.CANCELED)};async function X(){try{if(!R&&Object(d.c)(v,J,L)&&!U){const t=await Object(b.u)({http:P,alert:v,id:v.id});return G.addSuccess(l.i18n.translate("xpack.triggersActionsUI.sections.alertEdit.saveSuccessNotificationText",{defaultMessage:"Updated '{ruleName}'",values:{ruleName:t.name}})),t}s=Object(y.a)(v,K,q,L),S({command:{type:"setAlert"},payload:{key:"alert",value:s}})}catch(s){var t,e;G.addDanger(null!==(t=null===(e=s.body)||void 0===e?void 0:e.message)&&void 0!==t?t:l.i18n.translate("xpack.triggersActionsUI.sections.alertEdit.saveErrorNotificationText",{defaultMessage:"Cannot update rule."}))}var s}return Object(f.jsx)(n.EuiPortal,null,Object(f.jsx)(n.EuiFlyout,{onClose:Q,"aria-labelledby":"flyoutAlertEditTitle",size:"m",maxWidth:620,ownFocus:!1},Object(f.jsx)(n.EuiFlyoutHeader,{hasBorder:!0},Object(f.jsx)(n.EuiTitle,{size:"s","data-test-subj":"editAlertFlyoutTitle"},Object(f.jsx)("h3",{id:"flyoutTitle"},Object(f.jsx)(c.FormattedMessage,{defaultMessage:"Edit rule",id:"xpack.triggersActionsUI.sections.alertEdit.flyoutTitle"})))),Object(f.jsx)(O.a,null,Object(f.jsx)(g.a,{inFlyout:!0,waitForCheck:!0},Object(f.jsx)(n.EuiFlyoutBody,null,B&&Object(f.jsx)(i.a.Fragment,null,Object(f.jsx)(n.EuiCallOut,{size:"s",color:"danger",iconType:"alert","data-test-subj":"hasActionsDisabled",title:l.i18n.translate("xpack.triggersActionsUI.sections.alertEdit.disabledActionsWarningTitle",{defaultMessage:"This rule has actions that are disabled"})}),Object(f.jsx)(n.EuiSpacer,null)),Object(f.jsx)(u.a,{alert:v,dispatch:S,errors:J,actionTypeRegistry:T,ruleTypeRegistry:m,canChangeTrigger:!1,setHasActionsDisabled:I,setHasActionsWithBrokenConnector:M,operation:"i18n.translate('xpack.triggersActionsUI.sections.alertEdit.operationName', { defaultMessage: 'edit', })",metadata:h})),Object(f.jsx)(n.EuiFlyoutFooter,null,Object(f.jsx)(n.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(f.jsx)(n.EuiFlexItem,{grow:!1},Object(f.jsx)(n.EuiButtonEmpty,{"data-test-subj":"cancelSaveEditedAlertButton",onClick:()=>Q()},l.i18n.translate("xpack.triggersActionsUI.sections.alertEdit.cancelButtonLabel",{defaultMessage:"Cancel"}))),R?Object(f.jsx)(n.EuiFlexItem,{grow:!1},Object(f.jsx)(n.EuiSpacer,{size:"s"}),Object(f.jsx)(n.EuiLoadingSpinner,{size:"l"})):Object(f.jsx)(i.a.Fragment,null),Object(f.jsx)(n.EuiFlexItem,{grow:!1},Object(f.jsx)(n.EuiButton,{fill:!0,color:"secondary","data-test-subj":"saveEditedAlertButton",type:"submit",iconType:"check",isLoading:w,onClick:async()=>{k(!0);const t=await X();k(!1),t&&(e(o.b.SAVED),F&&F())}},Object(f.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.alertEdit.saveButtonLabel",defaultMessage:"Save"}))))))),D&&Object(f.jsx)(x.a,{onConfirm:()=>{N(!1),e(o.b.CANCELED)},onCancel:()=>{N(!1)}})))}}}]);