(window.tileMap_bundle_jsonpfunction=window.tileMap_bundle_jsonpfunction||[]).push([[1,4],{21:function(e,t,a){"use strict";var n,o=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},r=function(){var e={};return function(t){if(void 0===e[t]){var a=document.querySelector(t);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}e[t]=a}return e[t]}}(),i=[];function s(e){for(var t=-1,a=0;a<i.length;a++)if(i[a].identifier===e){t=a;break}return t}function l(e,t){for(var a={},n=[],o=0;o<e.length;o++){var r=e[o],l=t.base?r[0]+t.base:r[0],c=a[l]||0,u="".concat(l," ").concat(c);a[l]=c+1;var h=s(u),d={css:r[1],media:r[2],sourceMap:r[3]};-1!==h?(i[h].references++,i[h].updater(d)):i.push({identifier:u,updater:m(d,t),references:1}),n.push(u)}return n}function c(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var o=a.nc;o&&(n.nonce=o)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var i=r(e.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}return t}var u,h=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function d(e,t,a,n){var o=a?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(e.styleSheet)e.styleSheet.cssText=h(t,o);else{var r=document.createTextNode(o),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(r,i[t]):e.appendChild(r)}}function p(e,t,a){var n=a.css,o=a.media,r=a.sourceMap;if(o?e.setAttribute("media",o):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var f=null,g=0;function m(e,t){var a,n,o;if(t.singleton){var r=g++;a=f||(f=c(t)),n=d.bind(null,a,r,!1),o=d.bind(null,a,r,!0)}else a=c(t),n=p.bind(null,a,t),o=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(a)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else o()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=o());var a=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<a.length;n++){var o=s(a[n]);i[o].references--}for(var r=l(e,t),c=0;c<a.length;c++){var u=s(a[c]);0===i[u].references&&(i[u].updater(),i.splice(u,1))}a=r}}}},22:function(e,t,a){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var a=function(e,t){var a=e[1]||"",n=e[3];if(!n)return a;if(t&&"function"==typeof btoa){var o=(i=n,s=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(l," */")),r=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[a].concat(r).concat([o]).join("\n")}var i,s,l;return[a].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(a,"}"):a})).join("")},t.i=function(e,a,n){"string"==typeof e&&(e=[[null,e,""]]);var o={};if(n)for(var r=0;r<this.length;r++){var i=this[r][0];null!=i&&(o[i]=!0)}for(var s=0;s<e.length;s++){var l=[].concat(e[s]);n&&o[l[0]]||(a&&(l[2]?l[2]="".concat(a," and ").concat(l[2]):l[2]=a),t.push(l))}},t}},25:function(e,t,a){"use strict";function n(e,t,a){t&a?e[0]=(e[0]+e[1])/2:e[1]=(e[0]+e[1])/2}function o(e,t){return!(!t||!e)&&(!(t.top_left.lat>e.top_left.lat||t.top_left.lon<e.top_left.lon)&&!(t.bottom_right.lat<e.bottom_right.lat||t.bottom_right.lon>e.bottom_right.lon))}a.r(t),a.d(t,"convertToGeoJson",(function(){return i})),a.d(t,"geoContains",(function(){return o}));const r={1:[5009400,4992600],2:[1252300,624100],3:[156500,156e3],4:[39100,19500],5:[4900,4900],6:[1200,609.4],7:[152.9,152.4],8:[38.2,19],9:[4.8,4.8],10:[1.2,.595],11:[.149,.149],12:[.037,.019]};function i(e,{geohash:t,geocentroid:a,metric:o}){let i,l=1/0,c=-1/0;if(e&&e.rows){const r=e,u=t?r.columns[t.accessor]:null;if(u){const e=r.columns[o.accessor],h=a?r.columns[a.accessor]:null;i=r.rows.map((a=>{const o=a[u.id];if(!o)return!1;const r=function(e){const t=[16,8,4,2,1];let a=!0;const o=[],r=[];o[0]=-90,o[1]=90,r[0]=-180,r[1]=180;let i=90,s=180;return[...e].forEach((e=>{const l="0123456789bcdefghjkmnpqrstuvwxyz".indexOf(e);for(let e=0;e<5;e++){const c=t[e];a?(s=s/=2,n(r,l,c)):(i=i/=2,n(o,l,c)),a=!a}})),o[2]=(o[0]+o[1])/2,r[2]=(r[0]+r[1])/2,{latitude:o,longitude:r}}(o);let i;if(h){const e=a[h.id];i=[e.lon,e.lat]}else i=[r.longitude[2],r.latitude[2]];const d=[[r.latitude[0],r.longitude[0]],[r.latitude[0],r.longitude[1]],[r.latitude[1],r.longitude[1]],[r.latitude[1],r.longitude[0]]],p=[r.latitude[2],r.longitude[2]];null!=t&&t.params.useGeocentroid&&(i[0]=s(i[0],r.longitude[0],r.longitude[1]),i[1]=s(i[1],r.latitude[0],r.latitude[1]));const f=a[e.id];return l=Math.min(l,f),c=Math.max(c,f),{type:"Feature",geometry:{type:"Point",coordinates:i},properties:{geohash:o,geohash_meta:{center:p,rectangle:d},value:f}}})).filter((e=>!!e))}else i=[]}else i=[];const u={featureCollection:{type:"FeatureCollection",features:i},meta:{min:l,max:c,geohashPrecision:null==t?void 0:t.params.precision,geohashGridDimensionsAtEquator:null!=t&&t.params.precision?(h=t.params.precision,r[h]):void 0}};var h;return t&&t.accessor&&(u.meta.geohash=e.columns[t.accessor].meta),u}function s(e,t,a){return e>a?e=a:e<t&&(e=t),e}},27:function(e,t,a){switch(window.__kbnThemeTag__){case"v7dark":return a(28);case"v7light":return a(30);case"v8dark":return a(32);case"v8light":return a(34)}},28:function(e,t,a){var n=a(21),o=a(29);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var r={insert:"head",singleton:!1};n(o,r);e.exports=o.locals||{}},29:function(e,t,a){(t=a(22)(!1)).push([e.i,".tlmChart__wrapper,.tlmChart{flex:1 1 0;display:flex}\n",""]),e.exports=t},30:function(e,t,a){var n=a(21),o=a(31);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var r={insert:"head",singleton:!1};n(o,r);e.exports=o.locals||{}},31:function(e,t,a){(t=a(22)(!1)).push([e.i,".tlmChart__wrapper,.tlmChart{flex:1 1 0;display:flex}\n",""]),e.exports=t},32:function(e,t,a){var n=a(21),o=a(33);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var r={insert:"head",singleton:!1};n(o,r);e.exports=o.locals||{}},33:function(e,t,a){(t=a(22)(!1)).push([e.i,".tlmChart__wrapper,.tlmChart{flex:1 1 0;display:flex}\n",""]),e.exports=t},34:function(e,t,a){var n=a(21),o=a(35);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var r={insert:"head",singleton:!1};n(o,r);e.exports=o.locals||{}},35:function(e,t,a){(t=a(22)(!1)).push([e.i,".tlmChart__wrapper,.tlmChart{flex:1 1 0;display:flex}\n",""]),e.exports=t},37:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return g}));var n=a(5),o=a(16),r=a(8),i=a(10),s=a.n(i),l=a(0),c=a(9),u=a(1);function h(e,t,a){return a?[{label:e,value:t(a.properties.value)},{label:u.i18n.translate("tileMap.tooltipFormatter.latitudeLabel",{defaultMessage:"Latitude"}),value:a.geometry.coordinates[1]},{label:u.i18n.translate("tileMap.tooltipFormatter.longitudeLabel",{defaultMessage:"Longitude"}),value:a.geometry.coordinates[0]}]:""}var d=a(25);const p=e=>{const{getZoomPrecision:t,getPrecision:n,BaseMapsVisualization:o}=e;return class CoordinateMapsVisualization extends o{constructor(e,a,o){super(e,a,o),s()(this,"updateGeohashAgg",(()=>{const e=this._getGeoHashAgg();if(!e)return;const a={name:"bounds",data:{}},o=function(e){const t=e.top_left,a=e.bottom_right;let n=Object(r.round)(Math.abs(t.lat-a.lat),5);const o=Object(r.round)(Math.abs(a.lon-t.lon),5);0===n&&(n=o);const i=.5*n;let s=Object(r.round)(t.lat,5)+i;s>90&&(s=90);let l=Object(r.round)(a.lat,5)-i;l<-90&&(l=-90);const c=.5*o;let u=Object(r.round)(t.lon,5)-c;u<-180&&(u=-180);let h=Object(r.round)(a.lon,5)+c;return h>180&&(h=180),{top_left:{lat:s,lon:u},bottom_right:{lat:l,lon:h}}}(this._kibanaMap.getBounds());Object(d.geoContains)(e.sourceParams.params.boundingBox,o)?a.data.boundingBox=e.sourceParams.params.boundingBox:a.data.boundingBox={top_left:o.top_left,bottom_right:o.bottom_right};const i=t();a.data.precision=e.sourceParams.params.autoPrecision?i[this.handlers.uiState.get("mapZoom")]:n(e.sourceParams.params.precision),this.handlers.event(a)})),this._geohashLayer=null,this._tooltipFormatter=Object(c.mapTooltipProvider)(e,h)}async render(e,t){Object(l.b)().loadFontAwesome(),await super.render(e,t)}async _makeKibanaMap(){await super._makeKibanaMap(this._params);let e=this._kibanaMap.getGeohashPrecision(),t=!1;this.handlers.uiState.on("change",(e=>{"mapZoom"!==e&&"mapCenter"!==e||this.updateGeohashAgg()})),this._kibanaMap.on("zoomchange",(()=>{t=e!==this._kibanaMap.getGeohashPrecision(),e=this._kibanaMap.getGeohashPrecision()})),this._kibanaMap.on("zoomend",(()=>{const e=this._getGeoHashAgg();if(!e)return;("boolean"!=typeof e.sourceParams.params.autoPrecision||e.sourceParams.params.autoPrecision)&&(t?this.updateGeohashAgg():this._updateData(this._geoJsonFeatureCollectionAndMeta))})),this._kibanaMap.addDrawControl(),this._kibanaMap.on("drawCreated:rectangle",(e=>{const t=this._getGeoHashAgg();this.addSpatialFilter(t,"geo_bounding_box",e.bounds)})),this._kibanaMap.on("drawCreated:polygon",(e=>{const t=this._getGeoHashAgg();this.addSpatialFilter(t,"geo_polygon",{points:e.points})}))}async _updateData(e){if("Heatmap"===this._getMapsParams().mapType||e!==this._geoJsonFeatureCollectionAndMeta){if(this._geohashLayer&&(this._kibanaMap.removeLayer(this._geohashLayer),this._geohashLayer=null),!e)return this._geoJsonFeatureCollectionAndMeta=null,this._kibanaMap.removeLayer(this._geohashLayer),void(this._geohashLayer=null);this._geoJsonFeatureCollectionAndMeta&&e.featureCollection.features.length||(this._geoJsonFeatureCollectionAndMeta=e,this.updateGeohashAgg()),this._geoJsonFeatureCollectionAndMeta=e,this._recreateGeohashLayer()}}async _recreateGeohashLayer(){const{GeohashLayer:e}=await a.e(2).then(a.bind(null,36));this._geohashLayer&&(this._kibanaMap.removeLayer(this._geohashLayer),this._geohashLayer=null);const t=this._getGeohashOptions();this._geohashLayer=new e(this._geoJsonFeatureCollectionAndMeta.featureCollection,this._geoJsonFeatureCollectionAndMeta.meta,t,this._kibanaMap.getZoomLevel(),this._kibanaMap,(await Object(c.lazyLoadMapsLegacyModules)()).L),this._kibanaMap.addLayer(this._geohashLayer)}async _updateParams(){await super._updateParams(),this._kibanaMap.setDesaturateBaseLayer(this._params.isDesaturated);const e=this._getGeohashOptions();this._geohashLayer&&this._geohashLayer.isReusable(e)||(this._geoJsonFeatureCollectionAndMeta&&this._recreateGeohashLayer(),this._updateData(this._geoJsonFeatureCollectionAndMeta))}_getGeohashOptions(){const e=this._getMapsParams(),t=this._params.dimensions.metric,a=t?t.label:"",n=Object(l.a)().deserialize(t&&t.format);return{label:a,valueFormatter:this._geoJsonFeatureCollectionAndMeta?n.getConverterFor("text"):null,tooltipFormatter:this._geoJsonFeatureCollectionAndMeta?this._tooltipFormatter.bind(null,a,n.getConverterFor("text")):null,mapType:e.mapType,isFilteredByCollar:this._isFilteredByCollar(),colorRamp:e.colorSchema,heatmap:{heatClusterSize:e.heatClusterSize}}}addSpatialFilter(e,t,a){if(!e)return;const n=e.indexPatternId,o=e.field,r={meta:{negate:!1,index:n}};r[t]={ignore_unmapped:!0},r[t][o]=a;const{filterManager:i}=Object(l.c)();i.addFilters([r])}_getGeoHashAgg(){return this._geoJsonFeatureCollectionAndMeta&&this._geoJsonFeatureCollectionAndMeta.meta.geohash}_isFilteredByCollar(){const e=this._getGeoHashAgg();return!!e&&Object(r.get)(e,"sourceParams.params.isFilteredByCollar",false)}}};a(27);var f=a(2);const g=({deps:e,handlers:t,visData:a,visConfig:i})=>{const s=Object(n.useRef)(null),l=Object(n.useRef)(null),c=Object(n.useRef)(!0),u=t.uiState;Object(n.useEffect)((()=>{if(s.current&&c.current){c.current=!1;const a=p(e);l.current=new a(s.current,t,i)}}),[e,t,i,a]),Object(n.useEffect)((()=>{var e;null===(e=l.current)||void 0===e||e.render(a,i).then(t.done)}),[a,i,t.done]),Object(n.useEffect)((()=>{const e=()=>{var e;null===(e=l.current)||void 0===e||e.render().then(t.done)};return u.on("change",e),()=>{u.off("change",e)}}),[u,t.done]),Object(n.useEffect)((()=>()=>{var e;null===(e=l.current)||void 0===e||e.destroy(),l.current=null}),[]);const h=Object(n.useMemo)((()=>Object(r.throttle)((()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.resize()}),300)),[]);return Object(f.jsx)(o.EuiResizeObserver,{onResize:h},(e=>Object(f.jsx)("div",{className:"tlmChart__wrapper",ref:e},Object(f.jsx)("div",{className:"tlmChart",ref:s}))))}}}]);